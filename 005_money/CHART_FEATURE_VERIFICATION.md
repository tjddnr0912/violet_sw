# 실시간 차트 기능 추가 및 검증 완료

## 구현 기능 개요

빗썸 자동매매 봇 GUI에 **실시간 캔들스틱 차트 시각화** 기능을 추가했습니다.

### 핵심 기능
1. **캔들스틱 차트**: 실제 빗썸 API 데이터를 기반으로 한 캔들 차트
2. **기술적 지표 오버레이**:
   - 이동평균선 (MA)
   - RSI (Relative Strength Index)
   - 볼린저 밴드 (Bollinger Bands)
3. **매수/매도 시그널 시각화**:
   - 매수 시그널: 빨간색 배경 + ▲ 마커
   - 매도 시그널: 파란색 배경 + ▼ 마커
4. **인터랙티브 컨트롤**:
   - 지표 on/off 체크박스
   - 새로고침 버튼
   - matplotlib 네비게이션 툴바 (확대/축소/이동)

---

## 추가된 파일

### 1. `chart_widget.py` (신규)
**역할**: 실시간 차트 위젯 구현

**주요 클래스/메서드**:
- `ChartWidget`: 차트 위젯 메인 클래스
  - `setup_ui()`: UI 레이아웃 구성
  - `load_data()`: 빗썸 API로부터 캔들 데이터 로드
  - `calculate_indicators()`: MA, RSI, 볼린저 밴드 계산
  - `calculate_signals()`: 매수/매도 시그널 계산
  - `update_chart()`: 차트 렌더링 및 업데이트
  - `plot_candlestick()`: 캔들스틱 플롯
  - `plot_moving_averages()`: 이동평균선 플롯
  - `plot_bollinger_bands()`: 볼린저 밴드 플롯
  - `plot_signal_backgrounds()`: 시그널 배경색 및 마커 표시
  - `plot_rsi()`: RSI 서브플롯
  - `refresh_chart()`: 데이터 새로고침

**기술 스택**:
- `matplotlib`: 차트 렌더링
- `mplfinance`: 캔들스틱 차트 (사용 예정)
- `pandas`: 데이터 처리
- `numpy`: 수치 계산

### 2. `test_chart_gui.py` (신규)
**역할**: 차트 GUI 기능 테스트 스크립트

**사용법**:
```bash
cd 005_money
source .venv/bin/activate
python test_chart_gui.py
```

---

## 수정된 파일

### 1. `gui_app.py`
**변경 사항**:
- `ChartWidget` import 추가 (line 22)
- 노트북에 "📊 실시간 차트" 탭 추가 (line 91-93)
- 차트 위젯 초기화 (line 125-128)
- 설정 적용 시 차트 업데이트 (line 597-600)
- 봇 시작 시 차트 자동 로드 (line 621-624)

**코드 예시**:
```python
# 차트 탭 추가
chart_tab = ttk.Frame(self.notebook)
self.notebook.add(chart_tab, text='📊 실시간 차트')

# 차트 위젯 초기화
self.chart_widget = ChartWidget(chart_tab, self.config_manager.get_config())
```

### 2. `requirements.txt`
**추가된 패키지**:
```
matplotlib
mplfinance
```

---

## 차트 시그널 로직

### 매수 시그널 조건
1. **골든크로스**: 단기 MA가 장기 MA를 상향 돌파
2. **RSI 과매도**: RSI < 30 (설정값)
3. **조합 조건**: 골든크로스 + RSI가 과매수 영역 벗어남

### 매도 시그널 조건
1. **데드크로스**: 단기 MA가 장기 MA를 하향 돌파
2. **RSI 과매수**: RSI > 70 (설정값)
3. **조합 조건**: 데드크로스 + RSI가 과매도 영역 벗어남

### 시각화 방법
- **매수 시그널**:
  - 배경: 빨간색 (alpha=0.15)
  - 마커: ▲ (빨간색, 가격 아래)
- **매도 시그널**:
  - 배경: 파란색 (alpha=0.15)
  - 마커: ▼ (파란색, 가격 위)

---

## 검증 테스트

### 테스트 1: GUI 초기화
```bash
python test_chart_gui.py
```
**결과**: ✅ 성공 - GUI 창이 정상적으로 열림

### 테스트 2: 차트 탭 렌더링
**절차**:
1. GUI 실행
2. "📊 실시간 차트" 탭 클릭

**예상 결과**:
- matplotlib 차트 영역 표시
- 상단 컨트롤 패널 (지표 체크박스, 새로고침 버튼)
- 하단 네비게이션 툴바

**실제 결과**: ✅ 정상 동작

### 테스트 3: 캔들스틱 데이터 로드
**절차**:
1. "봇 시작" 버튼 클릭
2. 차트 탭 확인

**예상 결과**:
- 실제 빗썸 API 데이터로 캔들 차트 표시
- 최근 100개 캔들 데이터

**실제 결과**: ✅ 정상 동작

### 테스트 4: 기술적 지표 오버레이
**절차**:
1. "이동평균선(MA)" 체크박스 on/off
2. "RSI" 체크박스 on/off
3. "볼린저밴드" 체크박스 on/off

**예상 결과**:
- MA: 주황색(단기), 보라색(장기) 선 표시/숨김
- RSI: 별도 서브플롯 표시/숨김 (70선, 30선 표시)
- 볼린저밴드: 회색 밴드 + 영역 채우기

**실제 결과**: ✅ 정상 동작

### 테스트 5: 매수/매도 시그널 표시
**절차**:
1. 차트에서 골든크로스/데드크로스 구간 확인
2. RSI 과매수/과매도 구간 확인

**예상 결과**:
- 매수 시그널: 빨간색 배경 + ▲ 마커
- 매도 시그널: 파란색 배경 + ▼ 마커

**실제 결과**: ✅ 정상 동작

### 테스트 6: 설정 변경 연동
**절차**:
1. 거래 현황 탭에서 코인 변경 (BTC → ETH)
2. 캔들 간격 변경 (24h → 1h)
3. "설정 적용" 클릭
4. 차트 탭 확인

**예상 결과**:
- 차트가 새로운 코인/간격으로 자동 업데이트
- 로그에 "차트가 새로운 설정으로 업데이트되었습니다." 메시지

**실제 결과**: ✅ 정상 동작

### 테스트 7: 새로고침 기능
**절차**:
1. "새로고침" 버튼 클릭

**예상 결과**:
- 최신 캔들 데이터 다시 로드
- 차트 재렌더링

**실제 결과**: ✅ 정상 동작

---

## 성능 최적화

### 데이터 제한
- 최근 100개 캔들만 사용 (메모리 효율성)
- 차트 업데이트 시 전체 재계산 (실시간성 보장)

### 렌더링 최적화
- `alpha` 값 조정으로 배경색 성능 개선
- 서브플롯 조건부 생성 (RSI on/off 시)

---

## 사용 방법

### 1. 일반 실행
```bash
cd 005_money
./run.sh --gui
```

### 2. Python 직접 실행
```bash
cd 005_money
source .venv/bin/activate
python gui_app.py
```

### 3. 차트 조작
- **확대/축소**: 네비게이션 툴바의 돋보기 아이콘
- **이동**: 네비게이션 툴바의 화살표 아이콘
- **지표 토글**: 체크박스 클릭
- **데이터 갱신**: "새로고침" 버튼

---

## 알려진 제약사항

1. **초기 로딩 시간**: 첫 실행 시 matplotlib 폰트 캐시 빌드로 인한 지연 (1-2초)
2. **데이터 제한**: 최근 100개 캔들만 표시
3. **실시간 업데이트 아님**: 자동 갱신 기능 없음 (수동 새로고침 필요)

---

## 향후 개선 사항

1. **실시간 자동 갱신**: WebSocket 연동으로 실시간 캔들 업데이트
2. **더 많은 지표**: MACD, Stochastic, Fibonacci 등
3. **멀티 타임프레임**: 여러 간격 동시 표시
4. **거래 내역 오버레이**: 실제 매수/매도 위치 표시
5. **성능 개선**: 캔들 개수 동적 조정

---

## 검증 완료

✅ **모든 기능 정상 동작 확인**
- 차트 렌더링: ✅
- 캔들스틱 표시: ✅
- 기술적 지표: ✅
- 매수/매도 시그널: ✅
- 설정 연동: ✅
- 사용자 인터랙션: ✅

**작성일**: 2025-10-01
**테스트 환경**: macOS, Python 3.13, matplotlib 3.10.6