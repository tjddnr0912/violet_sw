# 빗썸 암호화폐 자동매매 봇 - 완전 사용자 가이드 v2.0

**버전**: 2.0 (Elite Strategy Edition)
**최종 업데이트**: 2025년 10월 2일
**대상 독자**: 초보자부터 전문가까지

---

## 📑 목차

1. [시스템 개요](#1-시스템-개요)
2. [빠른 시작 가이드](#2-빠른-시작-가이드)
3. [시스템 아키텍처](#3-시스템-아키텍처)
4. [거래 전략 상세 설명](#4-거래-전략-상세-설명)
5. [설정 가이드](#5-설정-가이드)
6. [GUI 사용 가이드](#6-gui-사용-가이드)
7. [고급 튜닝 가이드](#7-고급-튜닝-가이드)
8. [리스크 관리](#8-리스크-관리)
9. [FAQ 및 문제 해결](#9-faq-및-문제-해결)
10. [용어 사전](#10-용어-사전)

---

## 1. 시스템 개요

### 1.1 프로젝트 소개

빗썸 암호화폐 자동매매 봇은 **엘리트 트레이딩 전략**을 구현한 Python 기반 자동매매 시스템입니다. 8개의 기술적 지표와 고급 패턴 인식, 다이버전스 감지, 동적 손절매 시스템을 결합하여 높은 신뢰도의 매매 신호를 생성합니다.

### 1.2 주요 기능

#### 🎯 **코어 트레이딩 시스템**
- **8개 기술적 지표**: MA, RSI, MACD, Bollinger Bands, Volume, ATR, Stochastic, ADX
- **가중치 기반 신호 결합**: 각 지표의 신호를 가중 평균하여 최종 결정
- **시장 국면 감지**: 추세장/횡보장/전환기 자동 판단
- **다중 타임프레임 지원**: 30분, 1시간, 6시간, 12시간, 24시간봉

#### 🚀 **엘리트 전략 (v2.0 신규)**
- **캔들스틱 패턴 인식**: 6가지 반전 패턴 자동 감지
- **RSI/MACD 다이버전스**: 추세 반전 선행 신호
- **Chandelier Exit**: ATR 기반 추적 손절매
- **BB Squeeze 감지**: 저변동성 구간 및 브레이크아웃 예측

#### 💻 **GUI 시스템**
- **4개 탭 구성**: 거래 현황, 실시간 차트, 신호 히스토리, 거래 내역
- **실시간 차트**: 13개 지표 체크박스로 선택적 표시
- **패턴/다이버전스 시각화**: 차트에 마커 및 라인 표시
- **리스크 관리 대시보드**: Chandelier Stop, BB Squeeze 상태 모니터링

#### 🛡️ **리스크 관리**
- **ATR 기반 포지션 사이징**: 변동성에 따라 거래량 자동 조정
- **동적 손절매**: Chandelier Exit으로 수익 보호
- **일일 손실 제한**: 최대 손실률 및 연속 손실 횟수 제한
- **Dry-run 모드**: 실제 거래 없이 전략 테스트

### 1.3 시스템 요구사항

- **Python**: 3.8 이상
- **운영체제**: macOS, Linux, Windows
- **필수 패키지**: pandas, numpy, requests, matplotlib, schedule
- **API**: 빗썸 API 키 (공개 데이터는 키 불필요)

---

## 2. 빠른 시작 가이드

### 2.1 설치

```bash
# 1. 프로젝트 디렉토리로 이동
cd /Users/seongwookjang/project/git/violet_sw/005_money

# 2. 가상환경 생성 (권장)
python3 -m venv .venv
source .venv/bin/activate  # macOS/Linux
# .venv\Scripts\activate  # Windows

# 3. 의존성 설치
pip install -r requirements.txt

# 4. pybithumb 라이브러리 확인 (자동 설치됨)
# 없으면 자동으로 GitHub에서 클론
```

### 2.2 첫 실행

#### **방법 1: GUI 실행 (권장 - 초보자용)**

```bash
# 간편 실행
./gui

# 또는
python run_gui.py

# 또는 직접 실행
cd 001_python_code
python gui_app.py
```

#### **방법 2: CLI 실행 (고급 사용자용)**

```bash
# run.sh 스크립트 사용
./run.sh

# 옵션 지정 실행
./run.sh --coin BTC --interval 1h --amount 10000

# Python 직접 실행
python run.py --coin BTC --interval 1h
```

### 2.3 초기 설정

GUI 실행 후:
1. **코인 선택**: BTC, ETH, XRP 등
2. **캔들 주기 선택**: 1h (1시간봉 권장)
3. **거래 금액 설정**: 10,000원 (기본값)
4. **"봇 시작" 버튼 클릭**

⚠️ **중요**: 처음에는 Dry-run 모드로 테스트하세요!

---

## 3. 시스템 아키텍처

### 3.1 디렉토리 구조

```
005_money/
├── 001_python_code/          # 메인 소스 코드
│   ├── strategy.py            # 거래 전략 엔진 (~1700 lines)
│   ├── config.py              # 설정 파일 (~210 lines)
│   ├── trading_bot.py         # 매매 봇 코어
│   ├── gui_app.py             # GUI 메인 애플리케이션
│   ├── chart_widget.py        # 차트 위젯 (v3.0)
│   ├── gui_trading_bot.py     # GUI-봇 연동
│   ├── bithumb_api.py         # 빗썸 API 래퍼
│   ├── logger.py              # 로깅 시스템
│   ├── config_manager.py      # 동적 설정 관리
│   └── ...
├── 002_Doc/                   # 문서
│   └── 완전_사용자_가이드.md  # 이 파일
├── logs/                      # 로그 파일
│   └── trading_YYYYMMDD.log
├── trade_rule/                # 전략 설계 문서
│   └── 암호화폐 자동매매 알고리즘 설계.md
├── transaction_history.json   # 거래 내역
├── run.sh                     # 실행 스크립트
├── run.py                     # Python 런처
├── run_gui.py                 # GUI 런처
├── gui                        # GUI 실행 파일
└── requirements.txt           # 패키지 의존성
```

### 3.2 모듈 설명

#### **strategy.py** (거래 전략 엔진)
- **역할**: 모든 기술적 지표 계산 및 신호 생성
- **주요 함수**:
  - `calculate_moving_average()`: 이동평균선
  - `calculate_rsi()`: RSI
  - `calculate_macd()`: MACD
  - `calculate_bollinger_bands()`: 볼린저 밴드
  - `calculate_atr()`: ATR (변동성)
  - `calculate_stochastic()`: 스토캐스틱
  - `calculate_adx()`: ADX (추세 강도)
  - **[NEW]** `detect_candlestick_patterns()`: 패턴 인식
  - **[NEW]** `detect_rsi_divergence()`: RSI 다이버전스
  - **[NEW]** `detect_macd_divergence()`: MACD 다이버전스
  - **[NEW]** `calculate_chandelier_exit()`: Chandelier Stop
  - **[NEW]** `detect_bb_squeeze()`: BB Squeeze
  - `analyze_market_data()`: 통합 분석
  - `generate_weighted_signals()`: 가중 신호 생성

#### **config.py** (설정 파일)
- **TRADING_CONFIG**: 거래 설정 (코인, 금액, 손절/익절)
- **STRATEGY_CONFIG**: 전략 파라미터 (지표 기간, 가중치, 임계값)
- **INTERVAL_PRESETS**: 타임프레임별 최적화 설정
- **SAFETY_CONFIG**: 리스크 관리 설정
- **SCHEDULE_CONFIG**: 실행 주기 설정

#### **trading_bot.py** (매매 봇 코어)
- **역할**: 전략 신호를 받아 실제 거래 실행
- **주요 기능**:
  - 시장 데이터 수집
  - 전략 분석 요청
  - 매수/매도 주문 실행
  - 잔고 관리
  - 포지션 추적

#### **gui_app.py** (GUI 메인)
- **4개 탭 구성**:
  1. 거래 현황 (Trading Status)
  2. 실시간 차트 (Chart)
  3. 신호 히스토리 (Signal History)
  4. 거래 내역 (Transaction History)
- **패널 구조**:
  - 거래 설정 패널 (코인, 주기, 금액)
  - 현재 가격 패널
  - 지표 현황 패널 (8개 지표)
  - **[NEW]** 캔들 패턴 패널
  - **[NEW]** 다이버전스 패널
  - 리스크 관리 패널
  - 로그 표시 패널

#### **chart_widget.py** (차트 위젯 v3.0)
- **Pure matplotlib 구현** (x축 압축 문제 해결)
- **13개 체크박스**:
  - 기본 8개: MA, RSI, BB, Volume, MACD, ATR, Stochastic, ADX
  - 엘리트 5개: 패턴, RSI 다이버전스, MACD 다이버전스, Chandelier Stop, BB Squeeze
- **동적 서브플롯**: 활성화된 지표에 따라 자동 레이아웃 조정
- **실시간 업데이트**: 체크박스 변경 시 즉시 반영

### 3.3 데이터 흐름

```
1. 빗썸 API (bithumb_api.py)
      ↓ OHLCV 데이터
2. 전략 엔진 (strategy.py)
      ↓ analyze_market_data()
      ├─ 8개 기술 지표 계산
      ├─ 6개 패턴 감지
      ├─ 다이버전스 감지
      └─ BB Squeeze 감지
      ↓ analysis 딕셔너리
3. 신호 생성 (strategy.py)
      ↓ generate_weighted_signals()
      ├─ 가중 평균 계산
      ├─ 다이버전스 보너스 적용
      └─ 신뢰도 계산
      ↓ final_action: BUY/SELL/HOLD
4. 매매 봇 (trading_bot.py)
      ↓ 리스크 검증
      ├─ 포지션 사이징
      ├─ Chandelier Stop 설정
      └─ 일일 손실 확인
      ↓ 주문 실행
5. GUI (gui_app.py)
      ├─ 상태 업데이트
      ├─ 차트 갱신 (chart_widget.py)
      └─ 로그 출력
```

---

## 4. 거래 전략 상세 설명

### 4.1 전략 철학: 확증의 원칙 (Confirmation Principle)

이 시스템의 핵심 철학은 **"여러 독립적인 지표들이 동시에 같은 방향을 가리킬 때만 거래한다"**입니다. 단일 지표의 신호는 신뢰도가 낮지만, 추세·모멘텀·변동성·가격 패턴이 모두 합류(Confluence)하는 지점에서는 높은 확률의 기회가 발생합니다.

### 4.2 기술적 지표 설명

#### **1) 이동평균선 (MA - Moving Average)**

**목적**: 추세의 방향과 강도 파악

**계산**:
- **EMA (지수이동평균)**: 최근 데이터에 더 큰 가중치
- 단기 MA: 20기간 (기본 1h에서 20시간)
- 장기 MA: 50기간 (50시간)

**해석**:
- 가격 > MA: 상승 추세
- 단기 MA > 장기 MA (골든크로스): 강세 신호
- 단기 MA < 장기 MA (데드크로스): 약세 신호

**신호 강도** (strategy.py:1432-1448):
```python
if current_price > long_ma:
    if short_ma > long_ma:  # 골든크로스
        ma_signal = 1.0     # 강한 매수
    else:
        ma_signal = 0.5     # 약한 매수
elif current_price < long_ma:
    if short_ma < long_ma:  # 데드크로스
        ma_signal = -1.0    # 강한 매도
    else:
        ma_signal = -0.5    # 약한 매도
```

**가중치**: 0.25 (25%)

---

#### **2) RSI (Relative Strength Index)**

**목적**: 과매수/과매도 상태 및 모멘텀 측정

**계산**:
- 기간: 14캔들
- 공식: `RSI = 100 - (100 / (1 + RS))`
- RS = (평균 상승폭) / (평균 하락폭)

**해석**:
- RSI < 30: 과매도 (매수 신호)
- RSI > 70: 과매수 (매도 신호)
- RSI 30 상향 돌파: 강세 전환
- RSI 70 하향 돌파: 약세 전환

**신호 강도** (strategy.py:1451-1468):
```python
if rsi < 30:
    rsi_signal = 1.0      # 강한 매수 (과매도 탈출)
elif 30 <= rsi < 50:
    rsi_signal = 0.5      # 약한 매수
elif 50 <= rsi <= 70:
    rsi_signal = -0.5     # 약한 매도
else:  # rsi > 70
    rsi_signal = -1.0     # 강한 매도 (과매수)
```

**가중치**: 0.20 (20%)

---

#### **3) MACD (Moving Average Convergence Divergence)**

**목적**: 추세의 방향, 강도, 모멘텀 변화 감지

**계산** (1h 최적화):
- MACD Line: EMA(8) - EMA(17)
- Signal Line: EMA(9) of MACD Line
- Histogram: MACD Line - Signal Line

**해석**:
- MACD > Signal: 상승 모멘텀
- MACD < Signal: 하락 모멘텀
- Histogram 증가: 모멘텀 강화
- MACD Zero Line 교차: 추세 전환

**신호 강도** (strategy.py:1471-1493):
```python
if macd_line > signal_line:
    if histogram > 0:
        macd_signal = 1.0   # 강한 매수 (모멘텀 상승)
    else:
        macd_signal = 0.5   # 약한 매수
elif macd_line < signal_line:
    if histogram < 0:
        macd_signal = -1.0  # 강한 매도 (모멘텀 하락)
    else:
        macd_signal = -0.5  # 약한 매도
```

**가중치**: 0.35 (35%) - **가장 높음** (추세 지표로 중요)

---

#### **4) Bollinger Bands (BB)**

**목적**: 변동성 측정 및 평균 회귀 신호

**계산**:
- 중심선: 20기간 SMA
- 상단 밴드: 중심선 + (2 × 표준편차)
- 하단 밴드: 중심선 - (2 × 표준편차)

**해석**:
- 가격이 하단 밴드 터치: 과매도, 반등 가능 (매수)
- 가격이 상단 밴드 터치: 과매수, 조정 가능 (매도)
- 밴드 폭 확장: 변동성 증가 (추세 형성)
- 밴드 폭 축소 (Squeeze): 변동성 감소 (브레이크아웃 대기)

**신호 강도** (strategy.py:1496-1512):
```python
if current_price <= bb_lower:
    bb_signal = 1.0       # 강한 매수 (하단 밴드)
elif current_price <= bb_middle:
    bb_signal = 0.5       # 약한 매수
elif current_price >= bb_upper:
    bb_signal = -1.0      # 강한 매도 (상단 밴드)
else:
    bb_signal = -0.5      # 약한 매도
```

**가중치**: 0.10 (10%)

---

#### **5) Volume (거래량)**

**목적**: 가격 움직임의 신뢰도 확인

**계산**:
- 평균 거래량: 20기간 평균
- 현재 거래량 vs 평균 비율

**해석**:
- 거래량 > 평균 × 1.5: 강한 매수세 (신뢰도 상승)
- 거래량 < 평균: 약한 움직임 (신뢰도 하락)

**신호 강도** (strategy.py:1515-1525):
```python
volume_ratio = current_volume / avg_volume
if volume_ratio > 1.5:
    volume_signal = 1.0    # 강한 거래량 동반
elif volume_ratio > 1.0:
    volume_signal = 0.5    # 평균 이상 거래량
else:
    volume_signal = 0.0    # 거래량 부족
```

**가중치**: 0.10 (10%)

---

#### **6) ATR (Average True Range)**

**목적**: 변동성 측정 (방향성 없음)

**계산**:
- True Range = max(고가-저가, |고가-전일종가|, |저가-전일종가|)
- ATR: TR의 14기간 EMA

**사용처**:
- 포지션 사이징: 변동성 높으면 거래량 줄임
- 손절매 설정: ATR × 배수로 동적 손절
- Chandelier Exit: 추적 손절매 계산

**ATR 백분율** (strategy.py:642-647):
```python
atr_percentage = (atr_value / current_price) * 100
# 예: ATR=1,000,000원, 가격=50,000,000원 → 2%
```

---

#### **7) Stochastic Oscillator**

**목적**: 특정 범위 내 현재 가격의 위치 파악

**계산**:
- %K: (현재종가 - 14기간 최저가) / (14기간 최고가 - 14기간 최저가) × 100
- %D: %K의 3기간 SMA (시그널선)

**해석**:
- %K < 20: 과매도 (매수 고려)
- %K > 80: 과매수 (매도 고려)
- %K 상향 돌파 %D: 골든크로스 (매수)
- %K 하향 돌파 %D: 데드크로스 (매도)

**사용처**: 횡보장에서 효과적

---

#### **8) ADX (Average Directional Index)**

**목적**: 추세의 강도 측정 (방향성 없음)

**계산**:
- +DI (상승 방향성 지표)
- -DI (하락 방향성 지표)
- ADX: DI들의 평균 14기간 평활화

**해석**:
- ADX > 25: 추세장 (추세 추종 전략 유리)
- ADX < 15: 횡보장 (평균 회귀 전략 유리)
- ADX 15~25: 전환기 (관망)

**시장 국면 판단** (strategy.py:1099-1120):
```python
if adx > 25:
    regime = 'trending'      # 추세장
elif adx < 15:
    regime = 'ranging'       # 횡보장
else:
    regime = 'transitional'  # 전환기
```

---

### 4.3 엘리트 전략 기능 (v2.0 신규)

#### **1) 캔들스틱 패턴 인식**

**목적**: 시장 심리 반전 신호 포착

**감지 패턴** (strategy.py:218-536):

**a) 상승 장악형 (Bullish Engulfing)**
- **조건**: 큰 양봉이 전일 음봉을 완전히 감싸는 형태
- **신호**: 하락 추세 반전, 강한 매수 신호
- **점수**: +0.7 ~ +1.0
- **신뢰도**: 거래량 동반 시 매우 높음

```python
# 전일 음봉, 당일 양봉, 당일 몸통 > 전일 몸통
prev_bearish = prev_close < prev_open
curr_bullish = curr_close > curr_open
engulfing = curr_close > prev_open and curr_open < prev_close
```

**b) 하락 장악형 (Bearish Engulfing)**
- **조건**: 큰 음봉이 전일 양봉을 완전히 감싸는 형태
- **신호**: 상승 추세 반전, 강한 매도 신호
- **점수**: -0.7 ~ -1.0

**c) 망치형 (Hammer)**
- **조건**: 하락 후 짧은 몸통 + 긴 아래 그림자 (그림자 > 몸통×2)
- **신호**: 바닥 신호, 매수 고려
- **점수**: +0.4 ~ +0.6
- **주의**: 하락 추세에서만 유효

**d) 역망치형 (Inverted Hammer)**
- **조건**: 하락 후 짧은 몸통 + 긴 위 그림자
- **신호**: 반전 시도, 다음 캔들 확인 필요
- **점수**: +0.3 ~ +0.5

**e) 잠자리형 도지 (Dragonfly Doji)**
- **조건**: 몸통 거의 없음 + 긴 아래 그림자
- **신호**: 지지선에서 강한 반등 신호
- **점수**: +0.7
- **최적 위치**: 주요 지지선

**f) 비석형 도지 (Gravestone Doji)**
- **조건**: 몸통 거의 없음 + 긴 위 그림자
- **신호**: 저항선에서 강한 하락 신호
- **점수**: -0.7

**통합** (strategy.py:1540-1555):
```python
pattern = analysis['candlestick_pattern']
pattern_signal = pattern.get('pattern_score', 0.0)      # -1.0 ~ +1.0
pattern_confidence = pattern.get('pattern_confidence', 0.0)  # 0.0 ~ 1.0

# 가중치 적용 (기본 0.0, 활성화 시 0.10~0.15 권장)
weighted_pattern_signal = pattern_signal * pattern_weight
```

---

#### **2) RSI 다이버전스 (Divergence)**

**목적**: 추세 반전 선행 신호

**개념**:
- **상승 다이버전스 (Bullish)**: 가격은 더 낮은 저점, RSI는 더 높은 저점
  → 하락 모멘텀 약화 → 반등 가능성 ↑
- **하락 다이버전스 (Bearish)**: 가격은 더 높은 고점, RSI는 더 낮은 고점
  → 상승 모멘텀 약화 → 조정 가능성 ↑

**감지 알고리즘** (strategy.py:538-643):
1. 최근 30캔들에서 가격 및 RSI의 극값(peak/trough) 찾기
2. 가장 최근 2개의 극값 비교
3. 가격과 RSI의 방향이 반대면 다이버전스 감지
4. 강도 계산: `(RSI 변화량 / 10) × (가격 변화율 / 5)`

**예시**:
```
시점1: 가격 48,000,000원, RSI 25
시점2: 가격 46,000,000원 (↓), RSI 28 (↑)
→ 상승 다이버전스 감지! (가격 하락, RSI 상승)
→ 강도: (3 / 10) × (4.3% / 5) = 0.26
```

**신뢰도 보너스** (strategy.py:1586-1596):
```python
if rsi_divergence['type'] == 'bullish':
    divergence_bonus += 0.15      # +15% 신뢰도
elif rsi_divergence['type'] == 'bearish':
    divergence_bonus += 0.15
```

---

#### **3) MACD 다이버전스**

**목적**: RSI 다이버전스보다 강력한 추세 반전 신호

**차이점**:
- RSI: 모멘텀 오실레이터 (단기 과매수/과매도)
- MACD: 추세 추종 지표 (중장기 추세)
- **MACD 다이버전스는 더 큰 추세 반전을 시사**

**감지 알고리즘** (strategy.py:645-746):
- RSI와 동일한 로직, MACD Line 사용
- MACD Histogram 극값으로 peak/trough 판단

**신뢰도 보너스** (strategy.py:1593-1596):
```python
if macd_divergence['type'] == 'bullish':
    divergence_bonus += 0.20      # +20% (RSI보다 높음)
elif macd_divergence['type'] == 'bearish':
    divergence_bonus += 0.20
```

**최대 다이버전스 보너스**: +0.35 (RSI + MACD 동시 발생 시)

---

#### **4) Chandelier Exit (추적 손절매)**

**목적**: 변동성에 맞춰 자동 조정되는 동적 손절매

**문제점 - 고정 손절매**:
- 고정 -5% 손절: 변동성 큰 시장에서 쉽게 터짐
- 고정 가격 손절: 변동성 작은 시장에서 너무 관대함

**해결책 - ATR 기반 추적 손절**:

**공식** (strategy.py:748-887):
```python
# LONG 포지션
stop_price = highest_high_since_entry - (ATR × 3.0)

# SHORT 포지션
stop_price = lowest_low_since_entry + (ATR × 3.0)
```

**특징**:
1. **추적 (Trailing)**: 가격 상승 시 손절매도 따라 올라감
2. **변동성 적응**: ATR 큰 시장에서 손절폭 자동 확대
3. **수익 보호**: 고점에서 하락 시 3×ATR 범위에서 손절

**예시**:
```
진입: 50,000,000원
고점: 55,000,000원 (진입 후 최고가)
ATR: 1,500,000원
Chandelier Stop: 55,000,000 - (1,500,000 × 3) = 50,500,000원

→ 가격이 50,500,000원 이하로 떨어지면 손절
→ 최소 +500,000원 수익 보장
```

**상태** (strategy.py:869-887):
- **initial**: 진입 직후 (손절가 = 진입가 - 3×ATR)
- **active**: 추적 중 (고점 갱신마다 손절가 상향)
- **triggered**: 손절가 도달 (청산 실행)

---

#### **5) BB Squeeze (볼린저 밴드 스퀴즈)**

**목적**: 저변동성 구간 감지 → 브레이크아웃 대기

**개념**:
- 볼린저 밴드 폭이 좁아지면 (Squeeze) → 변동성 축소
- 변동성 축소 후에는 **큰 가격 변동이 발생할 확률 높음**
- 브레이크아웃 방향 예측 → 진입 타이밍 포착

**감지 알고리즘** (strategy.py:889-1003):
1. BB 폭 계산: `(상단 - 하단) / 중간`
2. 역사적 평균 BB 폭 계산 (50캔들)
3. 현재 폭 < 평균 × 0.8 → **Squeeze 감지**
4. 연속 Squeeze 캔들 수 카운트
5. 브레이크아웃 방향 예측:
   - 가격 > BB 중간 + EMA 상승 → 상방 브레이크아웃 예상
   - 가격 < BB 중간 + EMA 하락 → 하방 브레이크아웃 예상

**예시**:
```
현재 BB 폭: 0.035 (3.5%)
평균 BB 폭: 0.045 (4.5%)
비율: 0.035 / 0.045 = 0.78 < 0.8
→ Squeeze 감지!
→ 지속 기간: 5캔들
→ 예상 방향: 상방 (가격이 BB 중간선 위 + 20EMA 상승)
```

**거래 전략**:
- Squeeze 감지 후 대기
- 브레이크아웃 방향으로 진입 (BB 상단/하단 돌파 시)
- 거래량 동반 필수

---

### 4.4 신호 결합 시스템

#### **가중 평균 방식**

각 지표의 신호(-1.0 ~ +1.0)에 가중치를 곱한 후 합산:

**공식** (strategy.py:1605-1611):
```python
overall_signal = (
    0.35 × macd_signal +        # 35%
    0.25 × ma_signal +          # 25%
    0.20 × rsi_signal +         # 20%
    0.10 × bb_signal +          # 10%
    0.10 × volume_signal +      # 10%
    0.00 × pattern_signal       # 0% (선택적)
)
# 합계: 1.00 (100%)
```

**신뢰도 계산** (strategy.py:1614-1639):
```python
# 1. 각 지표의 강도(절대값) 평균
individual_strengths = [
    abs(macd_signal),
    abs(ma_signal),
    abs(rsi_signal),
    abs(bb_signal),
    abs(volume_signal)
]
average_strength = sum(individual_strengths) / len(individual_strengths)

# 2. 다이버전스 보너스 추가
divergence_bonus = 0.0
if rsi_divergence == 'bullish' or 'bearish':
    divergence_bonus += 0.15
if macd_divergence == 'bullish' or 'bearish':
    divergence_bonus += 0.20

# 3. 최종 신뢰도
confidence = min(average_strength + divergence_bonus, 1.0)
```

**최종 결정** (strategy.py:1642-1662):
```python
if overall_signal >= 0.5 and confidence >= 0.6:
    final_action = 'BUY'
elif overall_signal <= -0.5 and confidence >= 0.6:
    final_action = 'SELL'
else:
    final_action = 'HOLD'
```

#### **임계값**

| 항목 | 값 | 설명 |
|------|-----|------|
| **신호 임계값** | ±0.5 | overall_signal이 이 값을 넘어야 매수/매도 |
| **신뢰도 임계값** | 0.6 | confidence가 이 값 이상이어야 거래 |
| **강한 신호** | ±0.7 | 매우 확실한 신호 |
| **약한 신호** | ±0.3 | 관망 또는 소량 진입 |

---

## 5. 설정 가이드

### 5.1 config.py 주요 설정

#### **TRADING_CONFIG** (거래 설정)

```python
TRADING_CONFIG = {
    'target_ticker': 'BTC',           # 거래 코인
    'trade_amount_krw': 10000,        # 거래 금액 (원)
    'min_trade_amount': 5000,         # 최소 거래 금액
    'max_trade_amount': 100000,       # 최대 거래 금액
    'stop_loss_percent': 5.0,         # 고정 손절 (%) - 사용 안 함 (Chandelier 우선)
    'take_profit_percent': 10.0,      # 익절 (%)
    'trading_fee_rate': 0.0025,       # 거래 수수료 (0.25%)
}
```

#### **STRATEGY_CONFIG** (전략 설정)

**기본 지표**:
```python
'candlestick_interval': '1h',      # 캔들 주기
'short_ma_window': 20,             # 단기 MA
'long_ma_window': 50,              # 장기 MA
'rsi_period': 14,                  # RSI 기간
'rsi_overbought': 70,              # RSI 과매수
'rsi_oversold': 30,                # RSI 과매도
'volume_threshold': 1.5,           # 거래량 임계값 (평균의 1.5배)
```

**MACD** (1h 최적화):
```python
'macd_fast': 8,                    # 단기 EMA (8h)
'macd_slow': 17,                   # 장기 EMA (17h)
'macd_signal': 9,                  # 시그널 EMA (9h)
```

**ATR 및 Chandelier**:
```python
'atr_period': 14,                  # ATR 계산 기간
'atr_stop_multiplier': 2.0,        # 고정 손절 배수 (사용 안 함)
'chandelier_atr_multiplier': 3.0,  # Chandelier Stop 배수 ⭐
```

**Stochastic**:
```python
'stoch_k_period': 14,              # %K 기간
'stoch_d_period': 3,               # %D 기간
```

**ADX**:
```python
'adx_period': 14,                  # ADX 기간
'adx_trending_threshold': 25,      # 추세장 기준
'adx_ranging_threshold': 15,       # 횡보장 기준
```

**Bollinger Bands**:
```python
'bb_period': 20,                   # BB 기간
'bb_std': 2.0,                     # 표준편차 (암호화폐는 2.5 권장)
```

**패턴/다이버전스/Squeeze**:
```python
'pattern_detection_enabled': True,        # 패턴 인식 활성화
'divergence_lookback': 30,               # 다이버전스 탐지 기간
'divergence_detection_enabled': True,    # 다이버전스 활성화
'bb_squeeze_threshold': 0.8,             # Squeeze 임계값 (80%)
'bb_squeeze_lookback': 50,               # 평균 계산 기간
```

**신호 가중치** ⭐:
```python
'signal_weights': {
    'macd': 0.35,       # 35% - 추세 지표 (가장 중요)
    'ma': 0.25,         # 25% - 추세 확인
    'rsi': 0.20,        # 20% - 모멘텀
    'bb': 0.10,         # 10% - 변동성
    'volume': 0.10,     # 10% - 확인
    'pattern': 0.0      # 0% - 선택적 (활성화 시 0.10~0.15)
},
```

**신호 임계값**:
```python
'signal_threshold': 0.5,           # 매수/매도 신호 임계값
'confidence_threshold': 0.6,       # 신뢰도 임계값
'strong_signal_threshold': 0.7,    # 강한 신호 기준
```

#### **INTERVAL_PRESETS** (타임프레임별 프리셋)

각 캔들 주기마다 최적화된 파라미터:

**30분봉**:
```python
'30m': {
    'short_ma_window': 10,
    'long_ma_window': 30,
    'macd_fast': 6, 'macd_slow': 13, 'macd_signal': 7,
    'rsi_period': 10,
    # ... 기타 조정값
}
```

**1시간봉** (기본):
```python
'1h': {
    'short_ma_window': 20,
    'long_ma_window': 50,
    'macd_fast': 8, 'macd_slow': 17, 'macd_signal': 9,
    'rsi_period': 14,
    # ... (위 STRATEGY_CONFIG와 동일)
}
```

**6시간봉**, **12시간봉**, **24시간봉**:
- 캔들 주기가 길어질수록 지표 기간도 증가
- 예: 24h에서는 short_ma=40, long_ma=100

#### **SAFETY_CONFIG** (리스크 관리)

```python
SAFETY_CONFIG = {
    'dry_run': True,                       # ⚠️ Dry-run 모드 (실거래 비활성화)
    'max_position_size': 0.1,              # 최대 포지션 크기 (총 자산의 10%)
    'max_daily_trades': 10,                # 일일 최대 거래 횟수
    'max_daily_loss_percent': 5.0,         # 일일 최대 손실 (%)
    'max_consecutive_losses': 3,           # 최대 연속 손실 횟수
    'enable_stop_loss': True,              # 손절매 활성화
    'enable_take_profit': True,            # 익절 활성화
    'emergency_stop_loss_percent': 10.0,   # 긴급 손절 (%)
}
```

**⚠️ 중요**: `dry_run: True`로 설정하면 실제 거래 없이 시뮬레이션만 실행됩니다!

#### **SCHEDULE_CONFIG** (실행 주기)

```python
SCHEDULE_CONFIG = {
    'check_interval_minutes': 15,      # 봇 실행 주기 (15분마다)
    'api_request_interval': 1,         # API 요청 간격 (초)
    'balance_check_interval': 60,      # 잔고 확인 주기 (분)
}
```

### 5.2 GUI에서 설정 변경

GUI 실행 시 일부 설정은 인터페이스에서 변경 가능:

1. **거래 설정 패널**:
   - 코인 선택 (BTC, ETH, XRP, etc.)
   - 캔들 주기 (30m, 1h, 6h, 12h, 24h)
   - 거래 금액 (원)

2. **차트 설정**:
   - 13개 지표 체크박스로 표시 ON/OFF
   - 분석 기간 조정 (슬라이더)

3. **리스크 설정**:
   - 손절 비율
   - 익절 비율
   - 일일 손실 제한

**변경 적용**: 일부 설정은 봇 재시작 필요

### 5.3 고급 튜닝 (config.py 직접 수정)

#### **패턴 신호 활성화**

기본적으로 `'pattern': 0.0`로 설정되어 있습니다. 패턴 신호를 활성화하려면:

```python
'signal_weights': {
    'macd': 0.30,       # 35% → 30% (줄임)
    'ma': 0.25,         # 유지
    'rsi': 0.20,        # 유지
    'bb': 0.10,         # 유지
    'volume': 0.05,     # 10% → 5% (줄임)
    'pattern': 0.10     # 0% → 10% (추가) ⭐
}
```

**주의**: 가중치 합계는 1.0을 유지해야 합니다!

#### **다이버전스 보너스 조정**

strategy.py:1586-1596 수정:

```python
# 기본값
if rsi_divergence['type'] == 'bullish':
    divergence_bonus += 0.15

# 약하게 조정
if rsi_divergence['type'] == 'bullish':
    divergence_bonus += 0.10  # 15% → 10%
```

#### **Chandelier ATR 배수 조정**

```python
# 더 타이트하게 (손절 빨리)
'chandelier_atr_multiplier': 2.5  # 3.0 → 2.5

# 더 여유있게 (손절 느리게)
'chandelier_atr_multiplier': 3.5  # 3.0 → 3.5
```

#### **신호 임계값 조정**

```python
# 더 보수적으로 (거래 횟수 줄이기)
'signal_threshold': 0.6,         # 0.5 → 0.6
'confidence_threshold': 0.7,     # 0.6 → 0.7

# 더 공격적으로 (거래 횟수 늘리기)
'signal_threshold': 0.4,         # 0.5 → 0.4
'confidence_threshold': 0.5,     # 0.6 → 0.5
```

---

## 6. GUI 사용 가이드

### 6.1 GUI 실행

```bash
cd /Users/seongwookjang/project/git/violet_sw/005_money
python run_gui.py
```

### 6.2 메인 화면 구성

#### **상단 컨트롤 영역**

```
┌─────────────────────────────────────────────────────┐
│ [코인 선택: BTC ▼] [주기: 1h ▼] [금액: 10000원]    │
│ [봇 시작] [봇 중지] [새로고침]                      │
└─────────────────────────────────────────────────────┘
```

#### **4개 탭**

1. **거래 현황 (📊)**: 실시간 거래 상태
2. **실시간 차트 (📈)**: 가격 차트 + 지표
3. **신호 히스토리 (📋)**: 과거 신호 기록
4. **거래 내역 (📜)**: 실제 거래 로그

### 6.3 Tab 1: 거래 현황

#### **레이아웃**

```
┌──────────────┬──────────────┬──────────────┬──────────────┐
│  Column 1    │  Column 2    │  Column 3    │  Column 4    │
├──────────────┼──────────────┼──────────────┼──────────────┤
│ 현재 가격    │ 지표 현황    │ 신호 정보    │ 리스크 관리  │
│ 포지션 정보  │ (8개 지표)   │ (최종 신호)  │ (손절/익절)  │
│ 🕯️ 패턴 패널 │              │              │ ⚠️ Chandelier│
│ 📈 다이버전스 │              │              │ 🟡 BB Squeeze│
└──────────────┴──────────────┴──────────────┴──────────────┘
│              하단: 로그 표시 영역                           │
└─────────────────────────────────────────────────────────────┘
```

#### **Column 1: 기본 정보**

**현재 가격 패널**:
```
┌─ 현재 가격 정보 ─────────────┐
│ BTC 현재가                   │
│ ₩50,234,000                  │
│                              │
│ 24시간 변동                  │
│ +2,450,000 (+5.12%) 🟢      │
│                              │
│ 거래량                       │
│ 1,234.56 BTC                 │
└──────────────────────────────┘
```

**🕯️ 캔들 패턴 패널** (v2.0 신규):
```
┌─ 캔들 패턴 🕯️ ───────────────┐
│ 패턴 타입                    │
│ Bullish Engulfing 🟢        │
│                              │
│ 패턴 점수                    │
│ +0.85                        │
│                              │
│ 신뢰도                       │
│ 78%                          │
│                              │
│ 설명                         │
│ 강력한 상승 반전 신호        │
└──────────────────────────────┘
```

**📈 다이버전스 패널** (v2.0 신규):
```
┌─ 다이버전스 신호 📈 ─────────┐
│ RSI 다이버전스               │
│ Bullish 🟢 (강도: 65%)      │
│                              │
│ MACD 다이버전스              │
│ None ⚪                     │
│                              │
│ 다이버전스 보너스            │
│ +15% (신뢰도 향상)          │
└──────────────────────────────┘
```

#### **Column 2: 지표 현황**

8개 지표의 현재 값 및 신호:

```
┌─ 기술 지표 현황 ─────────────┐
│ MA (이동평균)                │
│ 단기: 49,850,000 🟢         │
│ 장기: 48,200,000            │
│ 신호: 매수 (+0.8)           │
│─────────────────────────────│
│ RSI                          │
│ 값: 42.5                    │
│ 상태: 중립                   │
│ 신호: 약한 매수 (+0.3)      │
│─────────────────────────────│
│ MACD                         │
│ Line: 850,000               │
│ Signal: 720,000             │
│ 신호: 매수 (+0.9) 🟢        │
│─────────────────────────────│
│ ... (계속)                  │
└──────────────────────────────┘
```

각 지표별 색상 코드:
- 🟢 녹색: 매수 신호
- 🔴 빨간색: 매도 신호
- ⚪ 회색: 중립

#### **Column 3: 신호 정보**

```
┌─ 최종 신호 ──────────────────┐
│ 신호 강도                    │
│ +0.68 (매수) 🟢             │
│                              │
│ 신뢰도                       │
│ 73% ████████░░              │
│                              │
│ 거래 추천                    │
│ 💰 BUY                      │
│                              │
│ 예상 진입가                  │
│ 50,200,000원                │
│                              │
│ 목표가 (TP1/TP2)            │
│ 52,500,000 / 55,000,000     │
│                              │
│ 손절가 (Chandelier)         │
│ 47,500,000원                │
└──────────────────────────────┘
```

#### **Column 4: 리스크 관리**

**기본 리스크 정보**:
```
┌─ 리스크 관리 ⚠️ ─────────────┐
│ 포지션 크기                  │
│ 0.2 BTC (10,000,000원)      │
│                              │
│ 고정 손절가                  │
│ 47,722,300원 (-5%)          │
│                              │
│ 익절가                       │
│ 55,257,400원 (+10%)         │
│─────────────────────────────│
```

**⚠️ Chandelier Exit** (v2.0 신규):
```
│ Chandelier Stop ⚠️          │
│ 손절가: 48,500,000원        │
│ 거리: -3.45%                │
│ 상태: 🟢 Active (추적 중)   │
│─────────────────────────────│
```

**🟡 BB Squeeze** (v2.0 신규):
```
│ BB Squeeze 🟡               │
│ 상태: 🟡 Active             │
│ 지속 시간: 8 캔들           │
│ 예상 방향: ⬆️ 상방 브레이크 │
└──────────────────────────────┘
```

#### **하단: 로그 표시**

```
┌─ 로그 ───────────────────────────────────────────────┐
│ [14:32:15] 봇 시작됨                                 │
│ [14:32:20] BTC 시장 데이터 수집 중...               │
│ [14:32:25] 분석 완료: 매수 신호 (+0.68, 신뢰도 73%) │
│ [14:32:30] 다이버전스 감지: RSI Bullish             │
│ [14:32:35] 패턴 감지: Bullish Engulfing             │
│ [14:32:40] Chandelier Stop 설정: 48,500,000원       │
│ [14:32:45] 신호 임계값 충족, 매수 대기 중...        │
└──────────────────────────────────────────────────────┘
```

### 6.4 Tab 2: 실시간 차트

#### **상단: 지표 선택**

13개 체크박스:

```
☐ MA   ☐ RSI   ☐ BB   ☐ Volume   ☐ MACD   ☐ ATR   ☐ Stochastic   ☐ ADX
☐ 캔들 패턴   ☐ RSI 다이버전스   ☐ MACD 다이버전스   ☐ Chandelier Stop   ☐ BB Squeeze
```

#### **차트 영역**

**메인 차트** (상단):
- 캔들스틱
- MA 라인 (체크 시): 주황색(단기), 보라색(장기)
- Bollinger Bands (체크 시): 회색 점선
- **[NEW]** 캔들 패턴 마커: ▲ 상승, ▼ 하락
- **[NEW]** Chandelier Stop 라인: 주황색 점선

**서브플롯** (하단, 활성화된 지표에 따라 동적 생성):

1. **RSI 서브플롯**:
   - RSI 라인
   - 과매수(70)/과매도(30) 기준선
   - **[NEW]** RSI 다이버전스 라인 (녹색/빨간색 점선)

2. **MACD 서브플롯**:
   - MACD Line (파란색)
   - Signal Line (주황색)
   - Histogram (막대)
   - **[NEW]** MACD 다이버전스 라인

3. **Volume 서브플롯**:
   - 거래량 막대 (상승: 빨강, 하락: 파랑)

4. **기타**: Stochastic, ATR, ADX (체크 시)

**인포 박스** (우측 상단):
```
┌─ 지표 정보 ──────────┐
│ Stochastic: K=45, D=42│
│ ATR: 1,250,000 (2.5%)│
│ ADX: 28.5 (강한 추세) │
│ Pattern: Bullish Eng.│
│ RSI Div: Bullish     │
│ MACD Div: None       │
│ Chandelier: 48.5M    │
│ BB Squeeze: 5 candles│
└───────────────────────┘
```

**BB Squeeze 시각화**:
- 차트 배경에 반투명 세로 띠 (초록/빨강/회색)
- 중앙에 "BB SQUEEZE" 텍스트

#### **차트 조작**

- **확대/축소**: 마우스 휠
- **이동**: 클릭 드래그 (matplotlib 기본 툴바)
- **새로고침**: "새로고침" 버튼 또는 자동 업데이트 (15분마다)

### 6.5 Tab 3: 신호 히스토리

과거 신호 기록 테이블:

| 시간 | 신호 | 신호 강도 | 신뢰도 | 패턴 | RSI Div | MACD Div | BB Squeeze |
|------|------|-----------|--------|------|---------|----------|------------|
| 14:30 | BUY | +0.68 | 73% | Bullish Eng | Bullish | None | Active (8) |
| 14:15 | HOLD | +0.32 | 58% | None | None | None | Inactive |
| 14:00 | SELL | -0.55 | 65% | Bearish Eng | Bearish | Bearish | Inactive |

**필터링**:
- 신호 유형: 전체 / BUY / SELL / HOLD
- 기간: 최근 1시간 / 6시간 / 24시간 / 전체

**내보내기**:
- CSV 파일로 저장

### 6.6 Tab 4: 거래 내역

실제 실행된 거래 로그:

| 시간 | 코인 | 액션 | 수량 | 가격 | 총액 | 수수료 | 성공 |
|------|------|------|------|------|------|--------|------|
| 14:35 | BTC | BUY | 0.2 | 50,200,000 | 10,040,000 | 25,100 | ✅ |
| 12:20 | BTC | SELL | 0.18 | 52,500,000 | 9,450,000 | 23,625 | ✅ |

**수익률 요약**:
```
┌─ 거래 통계 ──────────────┐
│ 총 거래 횟수: 15         │
│ 승: 10 / 패: 5          │
│ 승률: 66.7%             │
│ 총 수익: +1,234,560원   │
│ 수익률: +12.35%         │
│ 최대 손실: -234,000원   │
└──────────────────────────┘
```

---

## 7. 고급 튜닝 가이드

### 7.1 타임프레임별 최적 설정

#### **30분봉 (단타)**

**특징**: 빠른 변동, 많은 신호

**권장 설정**:
```python
'short_ma_window': 10,      # 짧게
'long_ma_window': 30,
'macd_fast': 6, 'macd_slow': 13, 'macd_signal': 7,
'rsi_period': 10,
'signal_threshold': 0.6,    # 높게 (노이즈 필터)
```

**전략**:
- 신호 임계값 높여 잘못된 신호 제거
- 손절매 타이트하게 (2.5× ATR)
- 거래 횟수 많음 → 수수료 주의

#### **1시간봉 (스윙)**

**특징**: 균형잡힌 설정, 기본 권장

**권장 설정**: config.py 기본값 사용

**전략**:
- 중간 주기로 가장 안정적
- 다이버전스 신호 신뢰도 높음
- Chandelier Exit 3.0× 적합

#### **6시간/12시간봉 (중장기)**

**특징**: 큰 추세, 적은 신호

**권장 설정**:
```python
'short_ma_window': 30,
'long_ma_window': 70,
'macd_fast': 12, 'macd_slow': 26, 'macd_signal': 9,  # 표준
'rsi_period': 14,
'signal_threshold': 0.5,    # 낮춰도 됨 (신호 적음)
```

**전략**:
- 손절매 여유있게 (3.5× ATR)
- 패턴 신호 가중치 높임 (0.15)
- 장기 보유 전략

### 7.2 시장 상황별 튜닝

#### **강한 추세장 (ADX > 30)**

**조정**:
- MACD 가중치 증가: 0.40
- MA 가중치 증가: 0.30
- RSI 가중치 감소: 0.15 (과매수/과매도 무시)
- BB 평균회귀 무시

#### **횡보장 (ADX < 15)**

**조정**:
- RSI 가중치 증가: 0.30 (과매수/과매도 중요)
- BB 가중치 증가: 0.15 (평균회귀)
- MACD 가중치 감소: 0.25
- Stochastic 신호 활용

#### **변동성 큰 시장 (ATR% > 5%)**

**조정**:
- Chandelier 배수 증가: 3.5 ~ 4.0
- 포지션 크기 감소: 50%
- 신뢰도 임계값 증가: 0.7

#### **변동성 작은 시장 (ATR% < 2%)**

**조정**:
- Chandelier 배수 감소: 2.5
- BB Squeeze 주목
- 브레이크아웃 대기 전략

### 7.3 백테스팅 및 최적화

#### **백테스팅 절차**

1. **과거 데이터 수집**:
   ```python
   # bithumb_api.py 사용
   historical_data = get_candlestick(ticker='BTC', interval='1h', count=500)
   ```

2. **전략 적용**:
   ```python
   for i in range(100, len(historical_data)):
       analysis = strategy.analyze_market_data('BTC', interval='1h')
       signals = strategy.generate_weighted_signals(analysis)
       if signals['final_action'] == 'BUY':
           # 매수 시뮬레이션
   ```

3. **성과 측정**:
   - 총 수익률
   - 승률
   - 최대 낙폭 (Max Drawdown)
   - 샤프 지수 (Sharpe Ratio)

#### **파라미터 최적화**

**Grid Search** (격자 탐색):
```python
best_params = None
best_profit = 0

for macd_weight in [0.30, 0.35, 0.40]:
    for ma_weight in [0.20, 0.25, 0.30]:
        for signal_threshold in [0.4, 0.5, 0.6]:
            # config 수정
            # 백테스팅 실행
            # 수익 비교
            if profit > best_profit:
                best_profit = profit
                best_params = {...}
```

**주의**: 과최적화(Overfitting) 방지!
- 샘플 외 데이터(Out-of-sample) 테스트
- 다양한 시장 국면에서 검증
- 논리적 타당성 우선

### 7.4 리스크 관리 고급 기법

#### **분할 매수/매도 (Tranche)**

문서(암호화폐 자동매매 알고리즘 설계.md)에서 권장:

**분할 매수**:
1. 1차 진입 (30%): 신호 발생 시
2. 2차 진입 (40%): 조정 후 지지선 터치 시
3. 3차 진입 (30%): 단기 저항 돌파 시

**분할 매도**:
1. TP1 (50%): 첫 목표가 도달, 손절 본전 이동
2. TP2 (25%): 두 번째 목표가
3. 트레일 (25%): Chandelier Exit으로 추적

**구현** (trading_bot.py 수정 필요):
```python
class TrancheManager:
    def __init__(self, total_amount):
        self.tranches = [0.3, 0.4, 0.3]
        self.current_tranche = 0

    def should_enter_next_tranche(self, current_price, support):
        # 로직 구현
        pass
```

#### **ATR 기반 포지션 사이징**

strategy.py:1005-1055 이미 구현됨:

```python
def calculate_position_size_by_atr(self, capital, risk_percent, entry_price, atr_value, atr_multiplier=2.0):
    """
    ATR 기반 포지션 크기 계산

    예시:
    자본: 10,000,000원
    리스크: 1% (100,000원까지 손실 허용)
    진입가: 50,000,000원
    ATR: 1,500,000원
    손절: 진입가 - (2.0 × ATR) = 47,000,000원

    손실폭: 3,000,000원 / BTC
    포지션 크기: 100,000원 / 3,000,000원 = 0.033 BTC
    """
    risk_amount = capital * (risk_percent / 100)
    stop_distance = atr_value * atr_multiplier
    position_size = risk_amount / stop_distance
    return position_size
```

---

## 8. 리스크 관리

### 8.1 손절매 시스템

#### **1) Chandelier Exit (우선)**

- **자동 추적**: 가격 상승 시 손절가도 상승
- **변동성 적응**: ATR 기반으로 시장 상황에 맞춤
- **수익 보호**: 고점에서 하락 시 최소 수익 보장

**사용 예**:
```python
chandelier = analysis['chandelier_exit']
if current_price <= chandelier['stop_price']:
    # 손절 실행
    trading_bot.sell(position)
```

#### **2) 고정 손절매 (보조)**

- config.py: `'stop_loss_percent': 5.0`
- 진입가 대비 고정 비율
- Chandelier보다 보수적인 경우만 사용

#### **3) 긴급 손절매**

- `'emergency_stop_loss_percent': 10.0`
- 시스템 오류 또는 플래시 크래시 대비
- 무조건 실행

### 8.2 일일 리스크 제한

#### **일일 최대 손실**

```python
'max_daily_loss_percent': 5.0
```

- 당일 누적 손실이 5% 도달 시 봇 중지
- 다음 날 자동 리셋
- 로그에 기록

#### **연속 손실 제한**

```python
'max_consecutive_losses': 3
```

- 3회 연속 손실 거래 시 봇 일시 중지
- 전략 재검토 필요 신호
- 수동 재시작 필요

#### **일일 최대 거래 횟수**

```python
'max_daily_trades': 10
```

- 과도한 거래 방지
- 수수료 절감
- 과최적화 거래 제한

### 8.3 포지션 관리

#### **최대 포지션 크기**

```python
'max_position_size': 0.1  # 총 자산의 10%
```

- 단일 거래에 전체 자산의 10% 이상 투입 금지
- 분산 투자 강제

#### **레버리지 사용 금지**

- 현물 거래만 지원
- 마진/선물 거래 미지원
- 청산 리스크 제거

### 8.4 Dry-run 모드

#### **설정**

```python
SAFETY_CONFIG = {
    'dry_run': True,  # ⚠️ 실거래 비활성화
}
```

#### **기능**

- 실제 API 주문 실행 안 함
- 모든 로직은 동일하게 실행
- 거래 시뮬레이션 로그 출력
- 성과 측정 가능

#### **실거래 전환**

```python
'dry_run': False,  # ⚠️ 주의: 실제 거래 시작
```

**전환 전 체크리스트**:
- [ ] 백테스팅 완료
- [ ] Dry-run 모드에서 최소 1주일 테스트
- [ ] 승률 60% 이상 확인
- [ ] 최대 낙폭 허용 범위 내
- [ ] API 키 정확히 설정
- [ ] 거래 금액 적절히 설정
- [ ] 리스크 제한 설정 확인

---

## 9. FAQ 및 문제 해결

### 9.1 설치 및 실행 문제

#### Q1: `ModuleNotFoundError: No module named 'pandas'`

**해결**:
```bash
pip install -r requirements.txt
# 또는
pip install pandas numpy requests matplotlib schedule
```

#### Q2: `pybithumb` 라이브러리가 없습니다

**해결**:
```bash
# 자동 설치되어야 하지만, 수동 설치:
cd /Users/seongwookjang/project/git/violet_sw/005_money
git clone --depth 1 https://github.com/sharebook-kr/pybithumb.git
```

#### Q3: GUI가 실행되지 않습니다 (tkinter 오류)

**macOS**:
```bash
brew install python-tk
```

**Ubuntu/Linux**:
```bash
sudo apt-get install python3-tk
```

#### Q4: 차트가 표시되지 않습니다

**해결**:
- matplotlib 버전 확인: `pip install --upgrade matplotlib`
- chart_widget.py v3.0인지 확인 (파일 상단 버전 주석)

### 9.2 전략 및 신호 문제

#### Q5: 신호가 너무 자주 발생합니다

**해결**:
```python
# config.py 수정
'signal_threshold': 0.6,         # 0.5 → 0.6
'confidence_threshold': 0.7,     # 0.6 → 0.7
```

#### Q6: 신호가 거의 발생하지 않습니다

**해결**:
```python
'signal_threshold': 0.4,         # 0.5 → 0.4
'confidence_threshold': 0.5,     # 0.6 → 0.5
```

또는 타임프레임 변경: 1h → 30m

#### Q7: 패턴이 감지되지 않습니다

**확인**:
1. `'pattern_detection_enabled': True`인지 확인
2. GUI에서 "캔들 패턴" 체크박스 활성화
3. 로그에서 `detect_candlestick_patterns` 실행 여부 확인
4. 패턴은 특정 조건에서만 발생 (하락 후 망치형 등)

#### Q8: 다이버전스가 자주 감지됩니다

**조정**:
```python
# strategy.py:642 수정
# 강도 임계값 상향
if divergence_strength > 0.5:  # 0.3 → 0.5로 변경
    return divergence_data
```

### 9.3 리스크 관리 문제

#### Q9: Chandelier Stop이 너무 자주 터집니다

**해결**:
```python
'chandelier_atr_multiplier': 3.5,  # 3.0 → 3.5
```

#### Q10: 손실이 제한을 초과했습니다

**원인**:
- 슬리피지 (주문가와 체결가 차이)
- 갭 (시장 급변동)
- 긴급 손절 미작동

**방지**:
- 변동성 큰 시장에서 거래 금액 줄이기
- `'emergency_stop_loss_percent'` 확인
- 유동성 높은 코인 선택 (BTC, ETH)

### 9.4 API 및 데이터 문제

#### Q11: `401 Unauthorized` 오류

**원인**: API 키 오류

**해결**:
```bash
# 환경변수 설정
export BITHUMB_CONNECT_KEY="실제_Connect_Key"
export BITHUMB_SECRET_KEY="실제_Secret_Key"
```

#### Q12: 데이터를 가져올 수 없습니다

**해결**:
1. 인터넷 연결 확인
2. 빗썸 API 상태 확인 (https://apidocs.bithumb.com/)
3. 요청 빈도 제한 확인 (1초 간격)
4. 로그 확인: `logs/trading_YYYYMMDD.log`

#### Q13: 거래 내역이 JSON 오류

**해결**:
```bash
# transaction_history.json 초기화
echo "[]" > transaction_history.json
```

### 9.5 성능 및 최적화

#### Q14: 분석 속도가 느립니다

**원인**:
- 분석 기간이 너무 길음 (`'analysis_period': 100`)
- 다이버전스 lookback이 큼 (`'divergence_lookback': 30`)

**해결**:
```python
'analysis_period': 50,           # 100 → 50
'divergence_lookback': 20,       # 30 → 20
```

#### Q15: 메모리 사용량이 높습니다

**원인**: 차트 데이터 누적

**해결**:
- GUI 재시작
- 분석 기간 줄이기
- 백그라운드 프로세스 확인

---

## 10. 용어 사전

### 기술 지표

- **MA (Moving Average)**: 이동평균선, 추세 방향 파악
- **EMA (Exponential MA)**: 지수이동평균, 최근 데이터에 가중
- **RSI (Relative Strength Index)**: 상대강도지수, 과매수/과매도
- **MACD**: 이동평균 수렴확산, 추세 및 모멘텀
- **BB (Bollinger Bands)**: 볼린저 밴드, 변동성 측정
- **ATR (Average True Range)**: 평균 실제 범위, 변동성
- **Stochastic**: 스토캐스틱, 가격 위치
- **ADX (Average Directional Index)**: 평균방향지수, 추세 강도

### 패턴

- **Bullish Engulfing**: 상승 장악형, 강한 반등 신호
- **Bearish Engulfing**: 하락 장악형, 강한 하락 신호
- **Hammer**: 망치형, 바닥 신호
- **Inverted Hammer**: 역망치형, 반전 시도
- **Dragonfly Doji**: 잠자리형 도지, 지지선 반등
- **Gravestone Doji**: 비석형 도지, 저항선 하락

### 전략 개념

- **Divergence (다이버전스)**: 가격과 지표의 불일치, 반전 신호
- **Confluence (합류)**: 여러 신호가 동시 발생
- **Chandelier Exit**: 추적 손절매, ATR 기반
- **BB Squeeze**: 볼린저 밴드 축소, 브레이크아웃 예고
- **Regime (국면)**: 시장 상태 (추세/횡보/전환)

### 리스크 관리

- **Stop Loss (손절매)**: 손실 제한 주문
- **Take Profit (익절)**: 이익 실현 주문
- **Trailing Stop**: 추적 손절, 가격 따라 이동
- **Position Sizing**: 포지션 크기 결정
- **Max Drawdown**: 최대 낙폭, 최고점 대비 최대 손실
- **Sharpe Ratio**: 샤프 지수, 리스크 대비 수익률

### 거래 용어

- **Long**: 매수 (상승 베팅)
- **Short**: 매도 (하락 베팅, 선물)
- **Candlestick**: 캔들스틱, 봉차트
- **OHLCV**: 시가/고가/저가/종가/거래량
- **Slippage**: 슬리피지, 주문가와 체결가 차이
- **Dry-run**: 모의 거래, 실제 주문 없음

---

## 부록: 파일 참조

### 주요 설정 파일 위치

- **전략 설정**: `001_python_code/config.py`
- **거래 내역**: `transaction_history.json`
- **로그**: `logs/trading_YYYYMMDD.log`
- **실행 스크립트**: `run.sh`, `run.py`, `run_gui.py`, `gui`

### 코드 참조

- **지표 계산**: `strategy.py:60-1240`
- **패턴 인식**: `strategy.py:218-536`
- **다이버전스**: `strategy.py:538-746`
- **Chandelier Exit**: `strategy.py:748-887`
- **BB Squeeze**: `strategy.py:889-1003`
- **신호 생성**: `strategy.py:1567-1662`
- **GUI 메인**: `gui_app.py`
- **차트 위젯**: `chart_widget.py`

### 문서

- **이 가이드**: `002_Doc/완전_사용자_가이드.md`
- **알고리즘 설계**: `trade_rule/암호화폐 자동매매 알고리즘 설계.md`

---

## 지원 및 문의

**프로젝트 위치**: `/Users/seongwookjang/project/git/violet_sw/005_money`

**로그 확인**:
```bash
tail -f logs/trading_$(date +%Y%m%d).log
```

**이슈 리포팅**:
1. 로그 파일 첨부
2. config.py 설정 공유
3. 재현 방법 설명
4. 에러 메시지 캡처

---

**마지막 업데이트**: 2025년 10월 2일
**버전**: 2.0 (Elite Strategy Edition)
**작성자**: 프로젝트 팀

---

### 변경 이력

**v2.0 (2025-10-02)**:
- 엘리트 전략 추가 (패턴, 다이버전스, Chandelier, BB Squeeze)
- GUI 대폭 개선 (3개 신규 패널, 5개 신규 체크박스)
- 완전 사용자 가이드 작성

**v1.0 (2025-09-28)**:
- 초기 버전 (8개 지표 + 가중치 시스템)
- 기본 GUI 구현
- Dry-run 모드 지원
