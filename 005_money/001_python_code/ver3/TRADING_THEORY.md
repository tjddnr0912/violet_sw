# Ver3 거래 이론 및 점수 계산

**버전:** Ver3 - Portfolio Multi-Coin Strategy
**최종 업데이트:** 2025-10-08
**기반 전략:** Ver2 Multi-Timeframe Stability Strategy

---

## 전략 개요

Ver3는 **Ver2의 다중 시간대 전략을 여러 코인에 동시 적용**하는 포트폴리오 관리 시스템입니다.

### 핵심 원리

Ver3는 세 가지 핵심 원리로 작동합니다:

1. **일봉 체제 필터** (Daily Timeframe)
   - 시장의 장기 방향을 판단
   - 상승 체제에서만 거래 허용

2. **4시간봉 점수 계산** (4H Timeframe)
   - 진입/청산 타이밍 결정
   - 점수 기반 신호 생성

3. **포트폴리오 리스크 관리**
   - 최대 2개 포지션 제한
   - 점수 높은 코인 우선 진입

### 전략 흐름도

```
┌─────────────────────────────────────────────────────┐
│ 1. 일봉 체제 필터 (Daily EMA 50/200)                │
│    - 상승 체제 확인 (Golden Cross)                   │
│    - 하락 체제면 거래 불가                           │
└──────────────┬──────────────────────────────────────┘
               ↓ (체제 OK)
┌─────────────────────────────────────────────────────┐
│ 2. 4시간봉 진입 점수 계산 (최대 4점)                 │
│    - 볼린저 밴드 터치: 1점                           │
│    - RSI 과매도: 1점                                │
│    - 스토캐스틱 골든크로스: 2점                      │
│    - 일봉 상승 체제: (보너스 조건)                   │
└──────────────┬──────────────────────────────────────┘
               ↓ (점수 2점 이상)
┌─────────────────────────────────────────────────────┐
│ 3. 포트폴리오 의사결정                               │
│    - 현재 포지션 수 확인 (0/2, 1/2, 2/2)            │
│    - 진입 후보 점수 비교                            │
│    - 최대 포지션 제한 적용                          │
└──────────────┬──────────────────────────────────────┘
               ↓ (진입 확정)
┌─────────────────────────────────────────────────────┐
│ 4. 주문 실행 및 포지션 관리                          │
│    - 매수 주문 전송                                 │
│    - 샹들리에 엑시트 손절 설정                       │
│    - 목표가 도달 시 부분 청산                        │
└─────────────────────────────────────────────────────┘
```

---

## 진입 점수 계산 (Entry Scoring)

### 점수 구성 (총 4점)

Ver3는 4가지 조건을 평가하여 진입 점수를 계산합니다. **최소 2점 이상**이면 진입 신호가 발생합니다.

---

#### 조건 1: 볼린저 밴드 터치 (1점)

**측정 방법:**
- 현재 캔들의 저가(Low)가 볼린저 밴드 하단선(Lower Band)에 근접했는지 확인

**계산 공식:**
```
볼린저 밴드 하단선 = MA(20) - 2 × StdDev(20)

조건:
저가 <= 하단선  →  1점 획득
```

**점수 부여 조건:**
```python
if latest['low'] <= latest['bb_lower']:
    score += 1  # 1점 추가
```

**의미:**
- 가격이 과매도 구간에 도달 (통계적으로 낮은 가격)
- 하단 밴드는 "지지선" 역할
- 반등 가능성 높음

**실전 예시:**
```
현재 가격: 42,000,000 KRW
볼린저 하단: 41,800,000 KRW
저가: 41,750,000 KRW

판단: 저가(41,750,000) < 하단(41,800,000)
결과: ✅ 1점 획득
```

---

#### 조건 2: RSI 과매도 (1점)

**측정 방법:**
- RSI(Relative Strength Index) 지표가 35 미만인지 확인

**계산 공식:**
```
RSI = 100 - (100 / (1 + RS))
RS = 평균 상승폭 / 평균 하락폭 (14일 기준)

조건:
RSI < 35  →  1점 획득
```

**점수 부여 조건:**
```python
if latest['rsi'] < 35:
    score += 1  # 1점 추가
```

**의미:**
- RSI는 매수/매도 압력을 측정 (0-100 범위)
- 35 미만: 매도 압력 과도, 과매도 상태
- 30 이하: 전통적인 과매도 기준
- 35 기준 사용: Ver2/Ver3는 조금 더 일찍 진입

**RSI 해석:**
- **70 이상:** 과매수 (매도 고려)
- **50:** 중립
- **35 미만:** 과매도 (매수 고려) ← Ver3 기준
- **30 미만:** 극심한 과매도

**실전 예시:**
```
14일간 평균 상승폭: 500,000 KRW
14일간 평균 하락폭: 1,200,000 KRW

RS = 500,000 / 1,200,000 = 0.417
RSI = 100 - (100 / (1 + 0.417)) = 29.4

판단: RSI(29.4) < 35
결과: ✅ 1점 획득
```

---

#### 조건 3: 스토캐스틱 골든크로스 (2점)

**측정 방법:**
- Stochastic RSI의 %K선이 %D선을 상향 돌파했는지 확인
- 돌파 시점에 둘 다 20 미만이어야 함

**계산 공식:**
```
1. RSI(14) 계산
2. Stochastic RSI 계산:
   %K = (RSI - RSI_min(14)) / (RSI_max(14) - RSI_min(14)) × 100
   %D = %K의 3일 이동평균

조건:
1) 이전 봉: %K <= %D  (데드크로스 상태)
2) 현재 봉: %K > %D   (골든크로스 발생)
3) %K < 20 AND %D < 20  (과매도 구간)

→ 모두 충족 시 2점 획득
```

**점수 부여 조건:**
```python
# 골든크로스 확인
k_cross_above = (
    previous['stoch_rsi_k'] <= previous['stoch_rsi_d'] and
    latest['stoch_rsi_k'] > latest['stoch_rsi_d']
)

# 과매도 구간 확인
both_below_threshold = (
    latest['stoch_rsi_k'] < 20 and
    latest['stoch_rsi_d'] < 20
)

if k_cross_above and both_below_threshold:
    score += 2  # 2점 추가 (가장 중요한 신호!)
```

**의미:**
- Stochastic RSI는 RSI의 변화율을 측정 (더 민감한 지표)
- 골든크로스: 단기 모멘텀이 상승으로 전환
- 과매도 구간에서의 골든크로스: 강한 반등 신호
- 2점 부여 이유: 가장 신뢰도 높은 진입 신호

**실전 예시:**
```
이전 봉 (4시간 전):
  %K = 18.5
  %D = 19.2
  상태: %K < %D (데드크로스)

현재 봉:
  %K = 19.8
  %D = 19.0
  상태: %K > %D (골든크로스 발생!)

판단:
1. 골든크로스 발생 ✅
2. %K(19.8) < 20 ✅
3. %D(19.0) < 20 ✅

결과: ✅ 2점 획득 (강력한 진입 신호!)
```

---

#### 조건 4: 일봉 상승 체제 (필수 조건, 점수 아님)

**측정 방법:**
- 일봉에서 EMA 50이 EMA 200보다 위에 있는지 확인

**계산 공식:**
```
EMA 50 = 50일 지수 이동평균
EMA 200 = 200일 지수 이동평균

조건:
EMA 50 > EMA 200  →  상승 체제 (거래 허용)
EMA 50 <= EMA 200  →  하락 체제 (거래 불가)
```

**의미:**
- Golden Cross 여부 확인 (장기 상승 추세)
- 이 조건을 만족해야 나머지 점수 계산 시작
- 점수 자체는 아니지만 **필수 통과 조건**

**실전 예시:**
```
일봉 데이터:
  EMA 50 = 43,500,000 KRW
  EMA 200 = 40,200,000 KRW

판단: EMA 50(43,500,000) > EMA 200(40,200,000)
결과: ✅ 상승 체제 확인 (거래 가능)

만약 EMA 50 < EMA 200이었다면:
결과: ❌ 하락 체제 (나머지 점수와 무관하게 진입 불가)
```

---

### 진입 점수 종합 예시

#### 예시 1: 완벽한 진입 신호 (4점)

```
일봉 체제: EMA 50(45M) > EMA 200(42M)  →  상승 체제 ✅

4시간봉:
1. 볼린저 밴드:
   - 저가: 44,100,000 KRW
   - 하단: 44,200,000 KRW
   - 저가 < 하단  →  1점 ✅

2. RSI:
   - RSI = 32.5
   - 32.5 < 35  →  1점 ✅

3. 스토캐스틱:
   - 이전: K=17.2, D=18.5 (K < D)
   - 현재: K=18.9, D=18.1 (K > D)
   - 골든크로스 발생 + 둘 다 20 미만  →  2점 ✅

총점: 4/4점
판단: 즉시 매수 (매우 강한 신호)
```

#### 예시 2: 강한 진입 신호 (3점)

```
일봉 체제: 상승 체제 ✅

4시간봉:
1. 볼린저 밴드: 터치 안 함  →  0점 ❌
2. RSI: 34.2 < 35  →  1점 ✅
3. 스토캐스틱: 골든크로스 발생  →  2점 ✅

총점: 3/4점
판단: 매수 (강한 신호, 충분히 진입 가능)
```

#### 예시 3: 최소 진입 신호 (2점)

```
일봉 체제: 상승 체제 ✅

4시간봉:
1. 볼린저 밴드: 터치함  →  1점 ✅
2. RSI: 36.8 > 35  →  0점 ❌
3. 스토캐스틱: 골든크로스 없음, K > 20  →  0점 ❌
   BUT, 일봉 상승 체제 보너스  →  1점 ✅

총점: 2/4점
판단: 매수 가능 (최소 조건 충족)
```

#### 예시 4: 진입 불가 (1점)

```
일봉 체제: 상승 체제 ✅

4시간봉:
1. 볼린저 밴드: 터치함  →  1점 ✅
2. RSI: 38.5 > 35  →  0점 ❌
3. 스토캐스틱: 조건 불충족  →  0점 ❌

총점: 1/4점
판단: 매수 불가 (최소 2점 필요)
```

#### 예시 5: 하락 체제 (진입 불가)

```
일봉 체제: EMA 50 < EMA 200  →  하락 체제 ❌

4시간봉:
1. 볼린저 밴드: 1점
2. RSI: 1점
3. 스토캐스틱: 2점

총점: 4/4점이지만...
판단: 매수 불가 (일봉 체제 필터 통과 실패)
```

---

### 진입 조건 요약

**필수 조건:**
- ✅ 일봉 상승 체제 (EMA 50 > EMA 200)

**진입 점수 조건:**
- ✅ **2점 이상:** 진입 가능
- ✅ **3점 이상:** 강력한 진입 신호 (권장)
- ✅ **4점:** 완벽한 진입 신호 (최우선)

**포트폴리오 제한:**
- 최대 2개 포지션
- 동시 진입 신호 시 점수 높은 코인 우선

---

## 청산 점수 계산 (Exit Scoring)

### 점수 구성 (총 3점)

청산은 진입보다 단순합니다. **2점 이상**이면 즉시 청산합니다.

---

#### 조건 1: 샹들리에 엑시트 (1점)

**측정 방법:**
- ATR(Average True Range) 기반 추적 손절
- 최근 최고가에서 ATR × 3배를 뺀 값이 현재가보다 높으면 청산

**계산 공식:**
```
샹들리에 라인 = 최근 최고가 - (ATR × 3.0)

조건:
현재가 < 샹들리에 라인  →  1점 획득 (추세 전환)
```

**점수 부여 조건:**
```python
chandelier_stop = highest_high - (atr × 3.0)

if current_price < chandelier_stop:
    exit_score += 1  # 추세 약화, 청산 고려
```

**의미:**
- ATR은 변동성을 측정 (평균 가격 변동폭)
- 샹들리에 엑시트는 추세 추종형 손절
- 가격이 라인 아래로 떨어지면 상승 추세 종료
- 3배 곱셈: 과도한 손절 방지 (변동성 고려)

**실전 예시:**
```
포지션 진입 후 최고가: 46,000,000 KRW
현재 ATR: 800,000 KRW
샹들리에 라인: 46,000,000 - (800,000 × 3) = 43,600,000 KRW

현재가: 43,400,000 KRW

판단: 현재가(43,400,000) < 샹들리에 라인(43,600,000)
결과: ✅ 1점 획득 (추세 전환, 청산 신호)
```

**추적 손절 예시:**
```
진입가: 42,000,000 KRW
ATR: 800,000 KRW

봉 1: 최고가 43,000,000  →  샹들리에: 40,600,000 (손절선 상승)
봉 2: 최고가 44,500,000  →  샹들리에: 42,100,000 (손절선 상승)
봉 3: 최고가 46,000,000  →  샹들리에: 43,600,000 (손절선 상승)
봉 4: 현재가 43,400,000  →  샹들리에 라인 돌파! 청산!

최종 수익: +1,400,000 KRW (3.3% 수익)
```

---

#### 조건 2: 수익 실현 타겟 (1점)

**측정 방법:**
- 볼린저 밴드 중간선(TP1) 또는 상단선(TP2) 도달 확인

**계산 공식:**
```
TP1 (First Target) = 볼린저 밴드 중간선 (MA 20)
TP2 (Second Target) = 볼린저 밴드 상단선 (MA 20 + 2×StdDev)

조건:
현재가 >= TP1  →  50% 청산 (1점)
현재가 >= TP2  →  100% 청산 (추가 1점)
```

**점수 부여 조건:**
```python
# TP1 도달 (중간선)
if current_price >= bb_middle:
    exit_score += 1  # 50% 청산
    position_size = position_size * 0.5

# TP2 도달 (상단선)
if current_price >= bb_upper:
    exit_score += 1  # 나머지 100% 청산
```

**의미:**
- 볼린저 밴드는 통계적 가격 범위
- 중간선: 평균 회귀 지점 (일부 수익 실현)
- 상단선: 과매수 구간 (전체 청산)
- 분할 청산으로 리스크 감소

**실전 예시 1: TP1 도달**
```
진입가: 42,000,000 KRW
포지션: 0.001 BTC

현재 상황:
- 현재가: 43,500,000 KRW
- 볼린저 중간선: 43,200,000 KRW
- 볼린저 상단선: 45,800,000 KRW

판단: 현재가(43,500,000) >= 중간선(43,200,000)
행동: TP1 도달! 50% 청산

청산: 0.0005 BTC @ 43,500,000 KRW
수익: (43,500,000 - 42,000,000) × 0.0005 = +750,000 KRW
남은 포지션: 0.0005 BTC (상단선까지 보유)
```

**실전 예시 2: TP2 도달**
```
(TP1 청산 후)
남은 포지션: 0.0005 BTC
진입가: 42,000,000 KRW

현재 상황:
- 현재가: 46,200,000 KRW
- 볼린저 상단선: 45,800,000 KRW

판단: 현재가(46,200,000) >= 상단선(45,800,000)
행동: TP2 도달! 나머지 100% 청산

청산: 0.0005 BTC @ 46,200,000 KRW
수익: (46,200,000 - 42,000,000) × 0.0005 = +2,100,000 KRW

총 수익: 750,000 + 2,100,000 = +2,850,000 KRW (6.8%)
```

---

#### 조건 3: EMA 데드크로스 (1점)

**측정 방법:**
- 일봉에서 EMA 50이 EMA 200 아래로 떨어졌는지 확인

**계산 공식:**
```
조건:
EMA 50 < EMA 200  →  1점 획득 (장기 하락 추세 전환)
```

**점수 부여 조건:**
```python
if daily_ema_50 < daily_ema_200:
    exit_score += 1  # 체제 전환, 청산 필요
```

**의미:**
- Death Cross 발생 (장기 하락 추세 시작)
- 진입 시 Golden Cross였으나 이제 반대
- 체제가 바뀌었으므로 보유 포지션 청산
- 향후 진입도 불가 (일봉 필터 통과 실패)

**실전 예시:**
```
포지션 진입 시 (2주 전):
  EMA 50: 43,500,000 KRW
  EMA 200: 40,200,000 KRW
  상태: Golden Cross (상승 체제)

현재:
  EMA 50: 42,800,000 KRW
  EMA 200: 43,100,000 KRW
  상태: Death Cross 발생! (하락 체제)

판단: EMA 50 < EMA 200
행동: ✅ 1점 획득, 즉시 청산 (체제 전환)
```

---

### 청산 점수 종합 예시

#### 예시 1: 즉시 청산 (3점)

```
포지션: BTC 0.001개 @ 42,000,000 KRW

현재 상황:
1. 샹들리에 엑시트:
   - 최고가: 46,000,000
   - ATR: 800,000
   - 라인: 43,600,000
   - 현재가: 43,400,000 < 43,600,000  →  1점 ✅

2. 수익 목표:
   - 현재가: 43,400,000
   - TP1 (중간선): 43,200,000
   - 현재가 >= TP1  →  1점 ✅

3. EMA 데드크로스:
   - EMA 50: 42,800,000
   - EMA 200: 43,100,000
   - EMA 50 < EMA 200  →  1점 ✅

총 청산 점수: 3/3점
판단: 즉시 전체 청산 (다중 청산 신호)
```

#### 예시 2: 부분 청산 (2점)

```
포지션: ETH 0.05개 @ 3,200,000 KRW

현재 상황:
1. 샹들리에 엑시트:
   - 현재가 > 샹들리에 라인  →  0점 ❌

2. 수익 목표:
   - 현재가: 3,350,000
   - TP1: 3,300,000  →  1점 ✅ (50% 청산)
   - TP2: 3,500,000  →  도달 안 함

3. EMA 데드크로스:
   - EMA 50 > EMA 200  →  0점 ❌ (여전히 상승 체제)

총 청산 점수: 1/3점
판단: TP1 도달, 50%만 청산 (나머지는 TP2까지 보유)
```

#### 예시 3: 손절 (2점)

```
포지션: XRP 100개 @ 800 KRW

현재 상황:
1. 샹들리에 엑시트:
   - 현재가: 750 KRW
   - 샹들리에 라인: 770 KRW
   - 750 < 770  →  1점 ✅

2. 수익 목표:
   - TP1 도달 안 함  →  0점 ❌

3. EMA 데드크로스:
   - EMA 50: 790
   - EMA 200: 810
   - EMA 50 < EMA 200  →  1점 ✅

총 청산 점수: 2/3점
판단: 즉시 청산 (손절 -6.25%)
```

---

### 청산 조건 요약

**즉시 청산:**
- ✅ **2점 이상:** 전체 또는 부분 청산
- ✅ **3점:** 강력한 청산 신호 (즉시 전체 청산)

**부분 청산:**
- ✅ TP1 도달: 50% 청산, 나머지는 TP2까지 보유
- ✅ TP2 도달: 나머지 100% 청산

**손절:**
- ✅ 샹들리에 엑시트: ATR × 3.0 (약 6-8% 손실)
- ✅ 체제 전환: Death Cross 발생 시 즉시 청산

---

## 포트폴리오 관리

### 진입 우선순위

Ver3는 여러 코인이 동시에 진입 신호를 보낼 때 **점수가 높은 코인부터 진입**합니다.

#### 우선순위 결정 규칙

```
1. 진입 점수 비교 (높을수록 우선)
   4점 > 3점 > 2점

2. 동점일 경우 coin_rank 비교
   BTC(4) > ETH(3) > XRP(2) > SOL(1)

3. 포트폴리오 제한 적용
   max_positions 초과 시 낮은 점수 코인 제외
```

#### 실전 예시 1: 동시 진입 신호

```
시나리오:
- 포트폴리오: 0/2 포지션 (빈 상태)
- 동시 진입 신호 발생

코인별 점수:
- BTC: 3/4점 (강한 신호)
- ETH: 4/4점 (완벽한 신호)
- XRP: 2/4점 (최소 신호)

우선순위 정렬:
1. ETH (4점) ← 최우선
2. BTC (3점)
3. XRP (2점)

포트폴리오 결정:
- max_positions = 2
- 진입 가능: 2개

실행:
✅ ETH 진입 (1순위)
✅ BTC 진입 (2순위)
⛔ XRP 대기 (포트폴리오 제한)

결과: ETH와 BTC 포지션 오픈
```

#### 실전 예시 2: 동점 처리

```
시나리오:
- 포트폴리오: 1/2 포지션 (BTC 보유 중)
- 신호 발생

코인별 점수:
- ETH: 3/4점
- XRP: 3/4점 (동점!)
- SOL: 2/4점

우선순위 정렬 (동점 시 coin_rank 사용):
1. ETH (3점, rank=3)
2. XRP (3점, rank=2) ← rank 낮음
3. SOL (2점)

포트폴리오 결정:
- 현재 1개 보유
- 진입 가능: 1개만

실행:
✅ ETH 진입 (동점이지만 coin_rank 높음)
⛔ XRP 대기
⛔ SOL 대기

결과: BTC + ETH 포지션 (2/2 가득 참)
```

#### 실전 예시 3: 포트폴리오 포화 상태

```
시나리오:
- 포트폴리오: 2/2 포지션 (BTC, ETH 보유)
- 신호 발생

코인별 점수:
- XRP: 4/4점 (완벽한 신호!)
- SOL: 3/4점

포트폴리오 결정:
- max_positions = 2 (이미 가득 참)
- 진입 가능: 0개

실행:
⛔ XRP 진입 불가 (포트폴리오 제한)
⛔ SOL 진입 불가

로그:
"⛔ Portfolio limit reached (2 positions), skipping XRP entry"

대안:
1. 기존 포지션 중 하나 청산 대기
2. 청산 후 XRP 자동 진입 (다음 사이클)
```

---

### 리스크 관리

#### 포트폴리오 레벨 리스크

**최대 포지션 수:**
```python
PORTFOLIO_CONFIG = {
    'max_positions': 2,  # 동시 최대 2개
}
```

**의미:**
- 2개 코인에만 집중 투자
- 과도한 분산 방지
- 집중력 있는 포트폴리오 관리

**리스크 계산:**
```
코인당 리스크: 2% (RISK_CONFIG['risk_per_trade_pct'])
최대 포지션: 2개
총 포트폴리오 리스크: 2% × 2 = 4%

max_portfolio_risk_pct: 6.0% (여유분 2%)
```

#### 포지션당 금액 및 리스크

**기본 설정:**
```python
POSITION_SIZING_CONFIG = {
    'base_amount_krw': 50000,  # 코인당 5만원
}

TRADING_CONFIG = {
    'trade_amount_krw': 50000,
}
```

**실제 투입 자금:**
```
코인 1개 진입: 50,000 KRW
최대 2개 진입: 100,000 KRW

권장 총 자금: 200,000 KRW 이상
(안전 마진 2배)
```

**손실 제한:**
```python
RISK_CONFIG = {
    'max_daily_loss_pct': 3.0,       # 일일 3% 손실 제한
    'max_consecutive_losses': 3,      # 연속 3회 손실 제한
    'max_daily_trades': 5,            # 일일 5회 거래 제한
}
```

**발동 예시:**
```
포트폴리오: 1,000,000 KRW

시나리오 1: 일일 손실 3% 초과
- 당일 손실: 32,000 KRW (3.2%)
- 발동: 일일 거래 중단
- 복구: 다음 날 00시

시나리오 2: 연속 손실 3회
- 1회: -10,000 KRW
- 2회: -15,000 KRW
- 3회: -12,000 KRW
- 발동: 1시간 거래 중단
- 복구: 1시간 후 또는 1회 승리

시나리오 3: 일일 거래 5회
- 오전 2회, 오후 3회
- 발동: 당일 신규 진입 중단
- 복구: 다음 날 00시
```

---

### 분산 효과

#### 왜 멀티코인 포트폴리오인가?

**단일 코인 (Ver2):**
```
BTC만 거래:
- BTC 10% 상승 → 포트폴리오 +10%
- BTC 10% 하락 → 포트폴리오 -10%
- 변동성: 매우 높음
```

**멀티코인 (Ver3):**
```
BTC + ETH 동시 거래 (각 50% 비중):
- BTC +10%, ETH +5% → 포트폴리오 +7.5%
- BTC -10%, ETH +5% → 포트폴리오 -2.5%
- 변동성: 완화됨
```

#### 상관관계 고려

**높은 상관관계 (비추천):**
```
BTC + ETH
- 상관계수: 0.85 (매우 높음)
- BTC 상승 시 ETH도 상승
- BTC 하락 시 ETH도 하락
- 분산 효과: 약함
```

**낮은 상관관계 (권장):**
```
BTC + XRP
- 상관계수: 0.45 (중간)
- BTC 상승해도 XRP 독립적
- BTC 하락 시 XRP는 상승 가능
- 분산 효과: 강함
```

#### 권장 코인 조합

**안정형 (낮은 변동성):**
```
default_coins: ['BTC']
max_positions: 1
→ BTC만 집중, 가장 안정적
```

**균형형 (중간 변동성):**
```
default_coins: ['BTC', 'ETH', 'XRP']
max_positions: 2
→ 2개 선택, 분산 효과와 집중력 균형
```

**공격형 (높은 변동성):**
```
default_coins: ['ETH', 'XRP', 'SOL']
max_positions: 2
→ 알트코인 중심, 고위험 고수익
```

---

## 실전 시나리오

### 시나리오 1: 완벽한 BTC 진입

**시장 상황:**
```
날짜: 2025-10-08 14:00
포트폴리오: 0/2 (빈 상태)
```

**BTC 분석 (일봉):**
```
체제 필터:
- EMA 50: 45,200,000 KRW
- EMA 200: 42,800,000 KRW
- 판단: EMA 50 > EMA 200 ✅ 상승 체제
```

**BTC 분석 (4시간봉):**
```
진입 점수:
1. 볼린저 밴드:
   - 저가: 44,100,000 KRW
   - 하단선: 44,200,000 KRW
   - 44,100,000 < 44,200,000 → 1점 ✅

2. RSI:
   - 현재 RSI: 32.8
   - 32.8 < 35 → 1점 ✅

3. 스토캐스틱:
   - 이전: K=16.5, D=18.2 (K < D)
   - 현재: K=19.3, D=17.8 (K > D)
   - 골든크로스 + 둘 다 < 20 → 2점 ✅

총점: 4/4점 (완벽한 신호!)
```

**포트폴리오 결정:**
```
진입 가능 여부:
- 현재 포지션: 0/2
- max_positions: 2
- 슬롯 여유: 2개

판단: ✅ BTC 진입 확정
```

**주문 실행:**
```
매수 주문:
- 코인: BTC
- 금액: 50,000 KRW
- 가격: 44,150,000 KRW
- 수량: 0.001133 BTC

손절 설정:
- ATR: 800,000 KRW
- 최고가: 44,150,000 KRW
- 샹들리에: 44,150,000 - (800,000 × 3) = 41,750,000 KRW
- 손절가: 41,750,000 KRW (-5.4%)

목표가:
- TP1 (중간선): 45,800,000 KRW (+3.7%, 50% 청산)
- TP2 (상단선): 47,400,000 KRW (+7.4%, 100% 청산)
```

**결과 (24시간 후):**
```
BTC 가격 추이:
- 14:00 진입: 44,150,000
- 18:00 상승: 45,900,000 (TP1 도달!)
  → 50% 청산 @ 45,900,000 (+3.9% 수익, +2,000 KRW)
- 익일 10:00 상승: 47,600,000 (TP2 도달!)
  → 나머지 50% 청산 @ 47,600,000 (+7.8% 수익, +1,960 KRW)

총 수익: +3,960 KRW (7.9% 수익)
포트폴리오: 1,003,960 KRW
```

---

### 시나리오 2: 동시 진입 신호 (우선순위 처리)

**시장 상황:**
```
날짜: 2025-10-09 10:00
포트폴리오: 0/2 (빈 상태)
```

**3개 코인 모두 진입 신호:**
```
BTC:
- 체제: 상승 ✅
- 점수: 3/4 (BB터치 + RSI과매도 + 일봉상승)
- 신호 강도: 0.75

ETH:
- 체제: 상승 ✅
- 점수: 4/4 (모든 조건 충족)
- 신호 강도: 1.00

XRP:
- 체제: 상승 ✅
- 점수: 2/4 (BB터치 + 일봉상승)
- 신호 강도: 0.50
```

**포트폴리오 우선순위 결정:**
```
진입 점수 정렬:
1. ETH: 4/4점 (최우선)
2. BTC: 3/4점
3. XRP: 2/4점

포트폴리오 제한:
- max_positions: 2
- 현재 포지션: 0
- 진입 가능: 2개

선택:
✅ ETH 진입 (1순위, 4점)
✅ BTC 진입 (2순위, 3점)
⛔ XRP 대기 (포트폴리오 제한)
```

**주문 실행:**
```
ETH 매수:
- 가격: 3,250,000 KRW
- 금액: 50,000 KRW
- 수량: 0.0154 ETH

BTC 매수:
- 가격: 45,300,000 KRW
- 금액: 50,000 KRW
- 수량: 0.001104 BTC

포트폴리오 상태: 2/2 (포화)
```

**결과 (48시간 후):**
```
ETH:
- 진입: 3,250,000
- TP1 도달: 3,380,000 (+4.0%)
  → 50% 청산, +3,000 KRW
- TP2 도달: 3,510,000 (+8.0%)
  → 100% 청산, +2,000 KRW
- 총 수익: +5,000 KRW

BTC:
- 진입: 45,300,000
- 샹들리에 손절: 44,100,000 (-2.6%)
  → 전체 청산, -1,300 KRW
- 손실: -1,300 KRW

포트폴리오 총손익:
ETH +5,000 + BTC -1,300 = +3,700 KRW (3.7% 수익)

분산 효과:
- BTC 손실을 ETH 수익이 상쇄
- 단일 코인이었다면 BTC -2.6% 손실
- 멀티코인으로 +3.7% 수익 달성!
```

---

## 참고사항

### 지표 이해를 위한 추가 자료

**볼린저 밴드:**
- 통계학의 표준편차 개념 활용
- 가격의 95% 확률 범위 표시
- 하단 터치 = 통계적으로 저렴한 가격

**RSI (Relative Strength Index):**
- 1978년 Welles Wilder 개발
- 매수/매도 압력 비율 측정
- 0-100 범위, 50=중립

**Stochastic RSI:**
- RSI의 변화율 측정 (더 민감)
- RSI가 느리다고 느낄 때 사용
- 골든크로스는 강력한 모멘텀 신호

**ATR (Average True Range):**
- 변동성 측정 지표
- 높을수록 가격 변동 큼
- 샹들리에 엑시트에 활용

**EMA (Exponential Moving Average):**
- 최근 가격에 더 큰 가중치
- SMA보다 빠른 반응
- Golden Cross = 장기 상승 신호

### 전략 성공을 위한 핵심

**1. 체제 필터 준수:**
- 일봉 하락 체제에서는 절대 진입 금지
- 아무리 4시간봉 점수가 높아도 체제 우선

**2. 점수 기반 진입:**
- 2점: 최소 조건 (신중히 진입)
- 3점: 권장 진입 (충분한 신호)
- 4점: 적극 진입 (강력한 신호)

**3. 포트폴리오 제한 준수:**
- max_positions 엄수
- 욕심내서 3개 포지션 금지

**4. 손절 엄격히 준수:**
- 샹들리에 라인 돌파 시 즉시 청산
- 감정 배제, 기계적 실행

**5. 분할 청산 활용:**
- TP1에서 50% 청산 (수익 확보)
- 나머지는 TP2까지 보유 (추가 수익)

### 실전 체크리스트

**매일 확인사항:**
- ✅ 포트폴리오 상태 (X/2 포지션)
- ✅ 일일 손익 (3% 손실 제한 확인)
- ✅ 로그 확인 (오류 없는지)

**매주 확인사항:**
- ✅ 승률 및 손익비 계산
- ✅ 진입/청산 점수 분포 분석
- ✅ 설정 조정 필요성 검토

**Dry-run 테스트:**
- 최소 1주일 Dry-run 필수
- 실거래 전 충분한 신호 확인
- 로그에서 점수 계산 검증

---

**Ver3 거래 이론 및 점수 계산 끝**

이론을 이해했다면 이제 실전입니다. Dry-run으로 충분히 테스트하세요! 📚
