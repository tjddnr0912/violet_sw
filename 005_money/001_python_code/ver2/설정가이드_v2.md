# Version 2 설정 가이드

## 📋 목차

1. [설정 파일 위치](#설정-파일-위치)
2. [주요 설정 항목](#주요-설정-항목)
3. [백테스팅 vs 실시간 거래](#백테스팅-vs-실시간-거래)
4. [GUI에서 설정 변경](#gui에서-설정-변경)
5. [고급 설정](#고급-설정)

---

## 설정 파일 위치

**메인 설정 파일:**
```
/Users/seongwookjang/project/git/violet_sw/005_money/001_python_code/ver2/config_v2.py
```

---

## 주요 설정 항목

### 1️⃣ 시간대 설정 (TIMEFRAME_CONFIG)

```python
TIMEFRAME_CONFIG = {
    'execution_interval': '4h',  # 진입/청산 시간대 (4시간봉)
    'regime_interval': '1d',     # 시장 체제 판단 시간대 (일봉)
    'execution_candles': 200,    # 4시간 캔들 개수
    'regime_candles': 250,       # 일봉 캔들 개수
}
```

**변경 예시:**
- 1시간봉으로 변경: `'execution_interval': '1h'`
- 12시간봉으로 변경: `'execution_interval': '12h'`

---

### 2️⃣ 시장 체제 필터 (REGIME_FILTER_CONFIG)

```python
REGIME_FILTER_CONFIG = {
    'ema_fast': 50,              # 빠른 EMA 기간
    'ema_slow': 200,             # 느린 EMA 기간
    'allow_long_in_bullish': True,   # 강세장에서 매수 허용
    'allow_long_in_bearish': False,  # 약세장에서 매수 금지
    'allow_short': False,        # 공매도 금지 (롱 전용)
}
```

**변경 가능:**
- EMA 기간 조정 (예: 20/100, 30/150 등)
- 약세장에서도 거래: `'allow_long_in_bearish': True`

---

### 3️⃣ 진입 점수 시스템 (ENTRY_SCORING_CONFIG)

```python
ENTRY_SCORING_CONFIG = {
    'min_entry_score': 3,  # 최소 진입 점수 (0~4)

    'scoring_rules': {
        # BB 하단 터치: +1점
        'bb_touch': {
            'enabled': True,
            'points': 1,
        },

        # RSI 과매도 (<30): +1점
        'rsi_oversold': {
            'enabled': True,
            'points': 1,
        },

        # 스토캐스틱 RSI 교차 (<20): +2점
        'stoch_rsi_cross': {
            'enabled': True,
            'points': 2,
        },
    },
}
```

**변경 예시:**
- 더 보수적으로: `'min_entry_score': 4` (모든 조건 만족 필요)
- 더 공격적으로: `'min_entry_score': 2`
- 특정 조건 비활성화: `'enabled': False`

---

### 4️⃣ 기술 지표 설정 (INDICATOR_CONFIG)

```python
INDICATOR_CONFIG = {
    # 볼린저 밴드
    'bb_period': 20,
    'bb_std': 2.0,

    # RSI
    'rsi_period': 14,
    'rsi_oversold': 30,

    # 스토캐스틱 RSI
    'stoch_rsi_period': 14,
    'stoch_period': 14,
    'stoch_k_smooth': 3,
    'stoch_d_smooth': 3,
    'stoch_oversold': 20,

    # ATR (샹들리에 손절용)
    'atr_period': 14,
    'chandelier_multiplier': 3.0,  # ATR의 3배
}
```

**최적화 팁:**
- 짧은 기간 = 더 민감, 신호 많음
- 긴 기간 = 덜 민감, 신호 적음
- 샹들리에 배수: 2.5~3.5 권장 (3.0이 표준)

---

### 5️⃣ 포지션 관리 (POSITION_CONFIG)

```python
POSITION_CONFIG = {
    'initial_position_pct': 50,  # 초기 진입 50%
    'first_target_pct': 50,      # 1차 목표에서 50% 청산
    'second_target_pct': 100,    # 2차 목표에서 100% 청산
    'risk_per_trade_pct': 2.0,   # 거래당 리스크 2%
    'use_atr_sizing': True,      # ATR 기반 포지션 사이징
}
```

**변경 예시:**
- 더 보수적: `'risk_per_trade_pct': 1.0`
- 더 공격적: `'risk_per_trade_pct': 3.0`
- 전체 진입: `'initial_position_pct': 100` (비권장)

---

### 6️⃣ 위험 관리 (RISK_CONFIG)

```python
RISK_CONFIG = {
    # 손절 설정
    'stop_loss_type': 'chandelier',  # 'chandelier' 또는 'fixed'
    'chandelier_atr_multiplier': 3.0,
    'fixed_stop_loss_pct': 5.0,      # 고정 손절 (대체용)

    # 본전 손절 전환
    'breakeven_after_first_target': True,

    # 일일 제한
    'max_daily_loss_pct': 3.0,       # 일일 손실 한도 3%
    'max_consecutive_losses': 3,     # 연속 손실 3회
    'max_daily_trades': 5,           # 하루 최대 5회 거래

    # 포지션 한도
    'max_position_size_pct': 10.0,   # 단일 포지션 최대 10%
}
```

**안전 설정 (보수적):**
```python
'max_daily_loss_pct': 2.0,
'max_consecutive_losses': 2,
'max_daily_trades': 3,
```

---

### 7️⃣ 백테스팅 설정 (BACKTESTING_CONFIG)

```python
BACKTESTING_CONFIG = {
    'initial_capital': 10000.0,  # 초기 자본 $10,000
    'commission': 0.001,         # 수수료 0.1%
    'slippage': 0.0005,          # 슬리피지 0.05%
    'lookback_months': 10,       # 10개월 백테스트
}
```

**변경 예시:**
- 더 긴 기간 테스트: `'lookback_months': 24` (2년)
- 자본 변경: `'initial_capital': 100000.0` ($100k)

---

## 백테스팅 vs 실시간 거래

### 현재 상태 (v2.0)

**⚠️ 중요: v2는 현재 백테스팅 전용입니다!**

v2는 Backtrader 라이브러리를 사용한 백테스팅 시스템으로 설계되었습니다. 실시간 거래 기능은 아직 구현되지 않았습니다.

### 백테스팅 실행 방법

```bash
cd /Users/seongwookjang/project/git/violet_sw/005_money/001_python_code/ver2
python3 main_v2.py
```

**백테스팅 결과:**
- 총 수익률
- 최대 손실 낙폭 (MDD)
- 샤프 지수
- 승률
- 거래 횟수
- 수익 팩터

### 실시간 거래 모드 추가 (향후 구현 필요)

실시간 거래를 위해서는 다음 설정이 필요합니다:

```python
# config_v2.py에 추가 필요
EXECUTION_CONFIG = {
    'mode': 'backtest',  # 'backtest' 또는 'live'
    'dry_run': True,     # True: 모의 거래, False: 실제 거래

    # 실시간 거래 설정
    'check_interval': 300,  # 5분마다 확인 (초 단위)
    'exchange': 'bithumb',

    # API 설정
    'api_key': None,     # 환경 변수에서 로드
    'api_secret': None,  # 환경 변수에서 로드
}

SAFETY_CONFIG = {
    'dry_run': True,                    # 기본값: 모의 거래
    'require_confirmation': True,       # 거래 전 확인
    'emergency_stop_loss_pct': 10.0,   # 긴급 손절 10%
}
```

**실시간 거래 활성화 (구현 후):**
```python
EXECUTION_CONFIG = {
    'mode': 'live',
    'dry_run': False,  # ⚠️ 실제 자금 사용!
}
```

---

## GUI에서 설정 변경

### 거래 현황 탭 - 설정 패널

GUI를 실행하면 "거래 현황" 탭 오른쪽에 **"설정 편집"** 버튼이 있습니다.

**수정 가능한 항목:**

1. **시장 체제 필터**
   - EMA Fast 기간 (기본: 50)
   - EMA Slow 기간 (기본: 200)
   - 확인 봉 수 (기본: 2)

2. **진입 점수 시스템**
   - 최소 진입 점수 (기본: 3)
   - BB 기간 (기본: 20)
   - BB 표준편차 (기본: 2.0)
   - RSI 기간 (기본: 14)
   - RSI 과매도 레벨 (기본: 30)
   - 스토캐스틱 설정

3. **위험 관리**
   - ATR 기간 (기본: 14)
   - 샹들리에 배수 (기본: 3.0)
   - 거래당 리스크 % (기본: 2.0)
   - 최대 연속 손실 (기본: 5)
   - 일일 손실 한도 % (기본: 5.0)
   - 최대 일일 거래 (기본: 2)

4. **포지션 관리**
   - 초기 포지션 % (기본: 50)
   - 1차 목표 % (기본: 50)

**설정 저장:**
- "저장" 버튼 클릭 → `config_v2.py` 파일에 저장
- "초기화" 버튼 클릭 → 기본값으로 복원

---

## 고급 설정

### 파라미터 최적화

`config_v2.py` 파일을 직접 수정하여 더 세밀한 조정 가능:

```bash
# 설정 파일 열기
cd /Users/seongwookjang/project/git/violet_sw/005_money/001_python_code/ver2
nano config_v2.py  # 또는 code config_v2.py
```

### 백테스팅 후 최적화

1. **기본 설정으로 백테스트 실행**
   ```bash
   python3 main_v2.py
   ```

2. **결과 분석:**
   - MDD 너무 높음 → 리스크 줄이기
   - 승률 너무 낮음 → 진입 점수 높이기
   - 거래 횟수 너무 적음 → 진입 점수 낮추기

3. **파라미터 조정 후 재실행**

### 민감도 테스트

주요 파라미터별 영향:

| 파라미터 | 증가 시 영향 |
|---------|------------|
| `min_entry_score` | 거래 감소, 승률 증가 |
| `risk_per_trade_pct` | 수익/손실 증가, 변동성 증가 |
| `chandelier_multiplier` | 손절 느슨, 손실 증가 가능 |
| `bb_period` | 신호 느려짐, 안정성 증가 |
| `rsi_oversold` | 과매도 판단 엄격, 신호 감소 |

---

## 🔒 안전 수칙

### 백테스팅 단계

1. **충분한 기간 테스트:** 최소 12개월 이상
2. **다양한 시장 조건:** 상승장, 하락장, 횡보장 포함
3. **현실적 수수료/슬리피지:** 과도하게 낙관적이지 않게

### 실시간 거래 전 (향후)

1. **Paper Trading 먼저:** 모의 거래 최소 1개월
2. **소액으로 시작:** 전체 자본의 10% 이하
3. **점진적 확대:** 안정성 확인 후 증가
4. **긴급 연락:** 문제 발생 시 즉시 중단 방법 숙지

---

## 📝 설정 예시

### 보수적 설정 (안정성 우선)

```python
ENTRY_SCORING_CONFIG = {
    'min_entry_score': 4,  # 모든 조건 필수
}

POSITION_CONFIG = {
    'risk_per_trade_pct': 1.0,  # 1% 리스크
}

RISK_CONFIG = {
    'max_daily_loss_pct': 2.0,
    'max_consecutive_losses': 2,
    'max_daily_trades': 2,
}
```

### 공격적 설정 (수익 극대화)

```python
ENTRY_SCORING_CONFIG = {
    'min_entry_score': 2,  # 낮은 기준
}

POSITION_CONFIG = {
    'risk_per_trade_pct': 3.0,  # 3% 리스크
}

RISK_CONFIG = {
    'max_daily_loss_pct': 5.0,
    'max_consecutive_losses': 5,
    'max_daily_trades': 10,
}
```

### 균형 설정 (권장)

```python
ENTRY_SCORING_CONFIG = {
    'min_entry_score': 3,  # 기본값
}

POSITION_CONFIG = {
    'risk_per_trade_pct': 2.0,  # 2% 리스크
}

RISK_CONFIG = {
    'max_daily_loss_pct': 3.0,
    'max_consecutive_losses': 3,
    'max_daily_trades': 5,
}
```

---

## 🆘 문제 해결

### 설정이 적용되지 않음

```bash
# Python 캐시 삭제
find . -type d -name "__pycache__" -exec rm -r {} +
find . -type f -name "*.pyc" -delete

# GUI 재시작
./gui -v ver2
```

### 설정 파일 복원

```bash
# Git으로 원본 복원
cd /Users/seongwookjang/project/git/violet_sw/005_money
git checkout 001_python_code/ver2/config_v2.py
```

---

## 📚 추가 자료

- **전략 명세서:** `004_trade_rule/Strategy_v2_final.md`
- **사용 설명서:** `001_python_code/ver2/사용설명서_v2.md`
- **백테스팅 가이드:** `001_python_code/ver2/README_v2.md`

---

**마지막 업데이트:** 2025-10-03
