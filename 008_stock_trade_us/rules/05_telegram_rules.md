# í…”ë ˆê·¸ë¨ ë´‡ ê·œì¹™

## ë´‡ ëª…ë ¹ì–´ ëª©ë¡

| ëª…ë ¹ì–´ | ì„¤ëª… | ê¶Œí•œ |
|--------|------|------|
| `/start` | ë´‡ ì‹œì‘/í™˜ì˜ ë©”ì‹œì§€ | ëª¨ë“  ì‚¬ìš©ì |
| `/help` | ë„ì›€ë§ í‘œì‹œ | ëª¨ë“  ì‚¬ìš©ì |
| `/status` | í¬íŠ¸í´ë¦¬ì˜¤ ìƒíƒœ | ë“±ë¡ëœ ì‚¬ìš©ì |
| `/holdings` | ë³´ìœ  ì¢…ëª© ëª©ë¡ | ë“±ë¡ëœ ì‚¬ìš©ì |
| `/today` | ì˜¤ëŠ˜ ìˆ˜ìµë¥  | ë“±ë¡ëœ ì‚¬ìš©ì |
| `/signals` | í˜„ì¬ ë§¤ë§¤ ì‹ í˜¸ | ë“±ë¡ëœ ì‚¬ìš©ì |
| `/screen` | ìŠ¤í¬ë¦¬ë‹ ì‹¤í–‰ | ê´€ë¦¬ì |
| `/balance` | ê³„ì¢Œ ì”ê³  ì¡°íšŒ | ê´€ë¦¬ì |
| `/stop` | ì—”ì§„ ì¤‘ì§€ | ê´€ë¦¬ì |

## ëª…ë ¹ì–´ ìƒì„¸

### /status
```
ğŸ“Š í¬íŠ¸í´ë¦¬ì˜¤ í˜„í™©

ì´ ìì‚°: â‚©102,345,678
í‰ê°€ì†ìµ: +â‚©2,345,678 (+2.34%)
ì˜¤ëŠ˜ ìˆ˜ìµ: +â‚©123,456 (+0.12%)

ë³´ìœ  ì¢…ëª©: 18ê°œ
í˜„ê¸ˆ ë¹„ì¤‘: 8.5%

ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: 14:30:00
```

### /holdings
```
ğŸ“‹ ë³´ìœ  ì¢…ëª© (18ê°œ)

1. ì‚¼ì„±ì „ì (005930)
   10ì£¼ | â‚©700,000 | +1.23%

2. SKí•˜ì´ë‹‰ìŠ¤ (000660)
   5ì£¼ | â‚©650,000 | -0.45%

3. í˜„ëŒ€ì°¨ (005380)
   3ì£¼ | â‚©600,000 | +2.10%

... (ì´í•˜ ìƒëµ)
```

### /today
```
ğŸ“ˆ ì˜¤ëŠ˜ì˜ ì„±ê³¼

ìˆ˜ìµë¥ : +0.85%
ì†ìµê¸ˆ: +â‚©850,000

ê±°ë˜ í˜„í™©:
- ë§¤ìˆ˜: 2ê±´ (â‚©1,200,000)
- ë§¤ë„: 1ê±´ (â‚©500,000)

ìƒìŠ¹ ì¢…ëª©: 12ê°œ
í•˜ë½ ì¢…ëª©: 6ê°œ
```

### /signals
```
ğŸ”” í˜„ì¬ ë§¤ë§¤ ì‹ í˜¸

ğŸ“ˆ ë§¤ìˆ˜ ì‹ í˜¸ (3ê°œ):
1. NAVER (035420) - ê°•ë ¥ë§¤ìˆ˜
   ì‹ í˜¸ê°•ë„: 0.85 | RSI: 32

2. ì¹´ì¹´ì˜¤ (035720) - ë§¤ìˆ˜
   ì‹ í˜¸ê°•ë„: 0.72 | RSI: 38

ğŸ“‰ ë§¤ë„ ì‹ í˜¸ (1ê°œ):
1. LGí™”í•™ (051910) - ë§¤ë„
   ì‹ í˜¸ê°•ë„: -0.65 | RSI: 75
```

### /screen
```
ğŸ” ìŠ¤í¬ë¦¬ë‹ ì‹œì‘...

ì§„í–‰: 50/200 (25%)
ì§„í–‰: 100/200 (50%)
ì§„í–‰: 150/200 (75%)
ì§„í–‰: 200/200 (100%)

âœ… ìŠ¤í¬ë¦¬ë‹ ì™„ë£Œ! (45.3ì´ˆ)

ìƒìœ„ 10ê°œ ì¢…ëª©:
1. ì‚¼ì„±ì „ì - ì ìˆ˜: 87.5
2. SKí•˜ì´ë‹‰ìŠ¤ - ì ìˆ˜: 82.3
3. í˜„ëŒ€ì°¨ - ì ìˆ˜: 78.9
...
```

### /balance
```
ğŸ’° ê³„ì¢Œ ì”ê³ 

ì˜ˆìˆ˜ê¸ˆ: â‚©8,500,000
ì£¼ì‹í‰ê°€: â‚©91,845,678
ì´ìì‚°: â‚©100,345,678

ë§¤ìˆ˜ê°€ëŠ¥: â‚©8,500,000
ì¶œê¸ˆê°€ëŠ¥: â‚©5,000,000
```

## ì•Œë¦¼ ìœ í˜•

### ë§¤ë§¤ ì•Œë¦¼
```python
def send_trade_notification(action, stock_name, quantity, price):
    emoji = "ğŸ”µ" if action == "BUY" else "ğŸ”´"
    message = f"""
{emoji} {action} ì²´ê²°

ì¢…ëª©: {stock_name}
ìˆ˜ëŸ‰: {quantity:,}ì£¼
ê°€ê²©: â‚©{price:,}
ê¸ˆì•¡: â‚©{quantity * price:,}
ì‹œê°„: {datetime.now().strftime('%H:%M:%S')}
"""
    send_message(message)
```

### ë¦¬ë°¸ëŸ°ì‹± ì•Œë¦¼
```python
def send_rebalance_notification(actions):
    message = "ğŸ”„ ë¦¬ë°¸ëŸ°ì‹± ì‹¤í–‰\n\n"

    for action in actions:
        if action['type'] == 'BUY':
            message += f"ğŸ“ˆ ë§¤ìˆ˜: {action['name']} {action['qty']}ì£¼\n"
        else:
            message += f"ğŸ“‰ ë§¤ë„: {action['name']} {action['qty']}ì£¼\n"

    message += f"\nì´ {len(actions)}ê±´ ì‹¤í–‰"
    send_message(message)
```

### ê²½ê³  ì•Œë¦¼
```python
ALERT_TEMPLATES = {
    "daily_loss": "âš ï¸ ì¼ì¼ ì†ì‹¤ -{loss:.1%} ê²½ê³ ",
    "stop_loss": "ğŸ›‘ {stock} ì†ì ˆ ì‹¤í–‰ (-{loss:.1%})",
    "take_profit": "âœ… {stock} ìµì ˆ ë‹¬ì„± (+{profit:.1%})",
    "api_error": "âŒ API ì˜¤ë¥˜ ë°œìƒ: {error}",
    "engine_stop": "ğŸš¨ ì—”ì§„ ë¹„ìƒ ì •ì§€",
}
```

### ì¼ê°„ ë¦¬í¬íŠ¸
```
ğŸ“Š ì¼ê°„ ë¦¬í¬íŠ¸ (2024-12-26)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“ˆ ìˆ˜ìµë¥ : +1.23%
ğŸ’° ì†ìµê¸ˆ: +â‚©1,230,000
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ê±°ë˜ ë‚´ì—­:
- ë§¤ìˆ˜ 3ê±´ / ë§¤ë„ 2ê±´
- ì´ ê±°ë˜ëŒ€ê¸ˆ: â‚©3,500,000

í¬íŠ¸í´ë¦¬ì˜¤:
- ë³´ìœ  ì¢…ëª©: 18ê°œ
- ìŠ¹ë¥ : 66.7% (4/6)
- ìƒ¤í”„ë¹„ìœ¨: 1.85

ìƒìœ„ ì¢…ëª©:
1. ì‚¼ì„±ì „ì +3.2%
2. NAVER +2.1%
3. í˜„ëŒ€ì°¨ +1.8%

í•˜ìœ„ ì¢…ëª©:
1. LGí™”í•™ -2.1%
2. ì¹´ì¹´ì˜¤ -1.5%

ë‹¤ìŒ ë¦¬ë°¸ëŸ°ì‹±: 2025-01-02
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

## ë©”ì‹œì§€ í˜•ì‹ ê·œì¹™

### HTML íŒŒì‹±
```python
# í…”ë ˆê·¸ë¨ì€ HTML ì§€ì›
parse_mode = "HTML"

# í—ˆìš© íƒœê·¸
# <b>bold</b>
# <i>italic</i>
# <code>monospace</code>
# <pre>preformatted</pre>
# <a href="url">link</a>

# íŠ¹ìˆ˜ë¬¸ì ì´ìŠ¤ì¼€ì´í”„
def escape_html(text):
    return text.replace("&", "&amp;").replace("<", "&lt;").replace(">", "&gt;")
```

### ë©”ì‹œì§€ ê¸¸ì´
```python
MAX_MESSAGE_LENGTH = 4096  # í…”ë ˆê·¸ë¨ í•œë„

def split_message(message):
    if len(message) <= MAX_MESSAGE_LENGTH:
        return [message]

    # ì¤„ ë‹¨ìœ„ë¡œ ë¶„í• 
    lines = message.split("\n")
    chunks = []
    current = ""

    for line in lines:
        if len(current) + len(line) + 1 > MAX_MESSAGE_LENGTH:
            chunks.append(current)
            current = line
        else:
            current += "\n" + line if current else line

    if current:
        chunks.append(current)

    return chunks
```

## ì ‘ê·¼ ì œì–´

### ì‚¬ìš©ì ì¸ì¦
```python
AUTHORIZED_USERS = [
    int(os.getenv("TELEGRAM_CHAT_ID")),
]

ADMIN_USERS = [
    int(os.getenv("TELEGRAM_ADMIN_ID")),
]

def check_authorization(chat_id, required_level="user"):
    if required_level == "admin":
        return chat_id in ADMIN_USERS
    return chat_id in AUTHORIZED_USERS
```

### ëª…ë ¹ì–´ ê¶Œí•œ
```python
def handle_command(update, context):
    chat_id = update.effective_chat.id
    command = update.message.text.split()[0][1:]  # Remove /

    # ê¶Œí•œ í™•ì¸
    if command in ADMIN_COMMANDS:
        if not check_authorization(chat_id, "admin"):
            send_message(chat_id, "ê´€ë¦¬ì ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.")
            return

    # ëª…ë ¹ì–´ ì‹¤í–‰
    handlers[command](update, context)
```

## ì—ëŸ¬ ì²˜ë¦¬

```python
def safe_send_message(chat_id, message):
    try:
        bot.send_message(
            chat_id=chat_id,
            text=message,
            parse_mode="HTML"
        )
        return True
    except TelegramError as e:
        logger.error(f"í…”ë ˆê·¸ë¨ ì „ì†¡ ì‹¤íŒ¨: {e}")
        return False
    except Exception as e:
        logger.error(f"ì˜ˆìƒì¹˜ ëª»í•œ ì˜¤ë¥˜: {e}")
        return False
```

## ì†ë„ ì œí•œ

```python
# í…”ë ˆê·¸ë¨ API í•œë„
MAX_MESSAGES_PER_SECOND = 30
MAX_MESSAGES_PER_MINUTE = 20  # ë™ì¼ ì±„íŒ…

# í ê¸°ë°˜ ì „ì†¡
message_queue = Queue()

def queue_message(message):
    message_queue.put(message)

def message_sender():
    while True:
        message = message_queue.get()
        send_message(message)
        time.sleep(0.1)  # 100ms ê°„ê²©
```
