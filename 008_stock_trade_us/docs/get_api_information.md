# 한국투자증권 KIS Developers API 정보

> 작성일: 2024-12-18
> 참고: [KIS Developers 공식 포털](https://apiportal.koreainvestment.com), [GitHub 공식 저장소](https://github.com/koreainvestment/open-trading-api)

---

## 목차

1. [API 개요](#api-개요)
2. [인증 방식](#인증-방식)
3. [국내주식 API](#국내주식-api)
4. [해외주식 API](#해외주식-api)
5. [파생상품 API](#파생상품-api)
6. [기타 API](#기타-api)
7. [실시간 데이터 (WebSocket)](#실시간-데이터-websocket)
8. [API 호출 제한](#api-호출-제한)
9. [에러 코드](#에러-코드)
10. [프로젝트 구현 현황](#프로젝트-구현-현황)

---

## API 개요

### KIS Developers란?

KIS Developers는 한국투자증권에서 제공하는 오픈API 플랫폼으로, 개발자들이 주식 매매 및 시세 조회 기능을 자동화할 수 있도록 지원합니다.

### 특징

| 항목 | 내용 |
|------|------|
| **API 방식** | REST API + WebSocket |
| **인증** | OAuth 2.0 (Bearer Token) |
| **데이터 형식** | JSON |
| **지원 환경** | 모의투자 / 실전투자 |
| **호출 제한** | 초당 20회 (REST), 40건 (WebSocket 구독) |

### Base URL

| 환경 | URL |
|------|-----|
| **실전투자** | `https://openapi.koreainvestment.com:9443` |
| **모의투자** | `https://openapivts.koreainvestment.com:29443` |

---

## 인증 방식

### 1. 접근 토큰 발급

```
POST /oauth2/tokenP
```

**요청 파라미터:**

| 파라미터 | 타입 | 필수 | 설명 |
|----------|------|------|------|
| grant_type | String | Y | "client_credentials" 고정 |
| appkey | String | Y | 앱 키 (32자리) |
| appsecret | String | Y | 앱 시크릿 |

**응답:**

```json
{
  "access_token": "eyJ0eXAiOiJKV1Qi...",
  "token_type": "Bearer",
  "expires_in": 86400
}
```

### 2. 해시키 발급 (POST 요청 시 필요)

```
POST /uapi/hashkey
```

주문 등 POST 요청 시 요청 Body의 무결성 검증을 위해 사용됩니다.

### 3. WebSocket 접속키 발급

```
POST /oauth2/Approval
```

실시간 데이터 수신을 위한 WebSocket 접속 시 필요합니다.

---

## 국내주식 API

### 주문/계좌 API

| API ID | API명 | 설명 | TR ID |
|--------|-------|------|-------|
| 001 | 주식주문(현금) | 현금 매수/매도 | TTTC0802U (매수), TTTC0801U (매도) |
| 002 | 주식주문(신용) | 신용 매수/매도 | TTTC0852U |
| 003 | 주식주문정정취소 | 주문 정정/취소 | TTTC0803U |
| 004 | 주식잔고조회 | 보유 종목 조회 | TTTC8434R |
| 005 | 주식일별주문체결조회 | 주문 체결 내역 | TTTC8001R |
| 006 | 매수가능조회 | 매수 가능 금액/수량 | TTTC8908R |
| 007 | 예수금상세조회 | 예수금 및 출금가능금액 | CTRP6548R |
| 008 | 주식정정취소가능주문조회 | 정정/취소 가능 주문 | TTTC8036R |
| 009 | 체결기준현재잔고 | 체결 기준 잔고 | TTTC8494R |

### 기본시세 API

| API ID | API명 | 설명 | TR ID |
|--------|-------|------|-------|
| 008 | 주식현재가 시세 | 종목 현재가 | FHKST01010100 |
| 009 | 주식현재가 체결 | 체결 정보 | FHKST01010300 |
| 010 | 주식현재가 일자별 | 일별 시세 | FHKST01010400 |
| 011 | 주식현재가 호가/예상체결 | 호가창 정보 | FHKST01010200 |
| 012 | 주식현재가 투자자 | 투자자별 매매동향 | FHKST01010600 |
| 013 | 주식현재가 회원사 | 회원사별 매매동향 | FHKST01010700 |
| 022 | 주식당일분봉조회 | 분봉 차트 데이터 | FHKST03010200 |
| 030 | 국내주식기간별시세 | 일/주/월/년봉 | FHKST03010100 |

### 업종/기타 API

| API ID | API명 | 설명 | TR ID |
|--------|-------|------|-------|
| 019 | 업종현재가 | 업종 지수 시세 | FHKUP03500100 |
| 020 | 업종기간별시세 | 업종 지수 차트 | FHKUP03500200 |
| 069 | 국내휴장일조회 | 휴장일 정보 | CTCA0903R |
| 074 | 종목정보 | 종목 기본 정보 | CTPF1002R |

### 종목정보 API

| API ID | API명 | 설명 | TR ID |
|--------|-------|------|-------|
| 101 | 국내주식 종목분류코드 | 업종/테마 분류 | CTPF1702R |
| 108 | 종목별투자의견 | 애널리스트 투자의견 | FHKST663800C0 |
| 104 | 종목별프로그램매매추이(일별) | 프로그램 매매 | FHPPG04650100 |
| 179 | 상장주식수조회 | 상장 주식 수 | HHKST08090000 |

### 재무정보 API

| API ID | API명 | 설명 | TR ID |
|--------|-------|------|-------|
| 051 | 재무비율 | PER, PBR, ROE 등 | FHKST66430300 |
| 053 | 손익계산서 | 매출, 영업이익 등 | FHKST66430200 |
| 054 | 재무상태표 | 자산, 부채, 자본 | FHKST66430100 |
| 063 | 배당정보 | 배당금, 배당률 | HHKDB669101C0 |

### 순위분석 API

| API ID | API명 | 설명 | TR ID |
|--------|-------|------|-------|
| 040 | 거래량순위 | 거래량 상위 종목 | FHPST01710000 |
| 070 | 시가총액상위 | 시총 상위 종목 | FHPST01740000 |
| 041 | 등락률순위 | 상승/하락률 상위 | FHPST01720000 |
| 048 | 외국인순매수상위 | 외국인 순매수 | FHPST01760000 |
| 049 | 기관순매수상위 | 기관 순매수 | FHPST01770000 |
| 042 | 52주신고저가 | 52주 신고/신저가 | FHPST01730000 |
| 065 | 호가잔량상위 | 매수/매도 호가잔량 | FHPST01750000 |

---

## 해외주식 API

### 주문/계좌 API

| API ID | API명 | 설명 |
|--------|-------|------|
| 001 | 해외주식 주문 | 미국/아시아 주식 매수/매도 |
| 002 | 해외주식 정정취소 | 주문 정정/취소 |
| 003 | 해외주식 예약주문 | 예약 주문 등록 |
| 007 | 해외주식 잔고 | 보유 종목 조회 |
| 009 | 해외주식 체결기준잔고 | 체결 기준 잔고 |
| 010 | 해외주식 주문내역 | 주문 내역 조회 |

### 시세 API

| API ID | API명 | 설명 |
|--------|-------|------|
| 001 | 해외주식 현재가 | 실시간 현재가 (프리미엄) |
| 002 | 해외주식 기간별시세 | 일/주/월 봉 차트 |
| 003 | 해외주식 조건검색 | 조건 검색 |
| 010 | 해외주식 현재가 지연체결가 | 15분 지연 시세 (미국) |
| 011 | 해외주식 현재가 지연호가 | 15분 지연 호가 (아시아) |

### 지원 거래소

| 국가 | 거래소 | 거래시간 (한국시간) |
|------|--------|---------------------|
| 미국 | NYSE, NASDAQ, AMEX | 23:30 ~ 06:00 |
| 일본 | 도쿄증권거래소 | 09:00 ~ 15:00 |
| 홍콩 | 홍콩증권거래소 | 10:30 ~ 17:00 |
| 중국 | 상해/심천 | 10:30 ~ 16:00 |
| 베트남 | 호치민/하노이 | 09:00 ~ 15:30 |

---

## 파생상품 API

### 국내 선물/옵션

| API ID | API명 | 설명 |
|--------|-------|------|
| 001 | 선물옵션 주문 | KOSPI200 선물/옵션 매매 |
| 002 | 선물옵션 정정취소 | 주문 정정/취소 |
| 003 | 선물옵션 잔고 | 미결제 포지션 조회 |
| 004 | 선물옵션 주문가능조회 | 증거금/주문가능 수량 |
| 007 | 선물옵션 현재가 | 실시간 시세 |

### 해외 선물/옵션

| API ID | API명 | 설명 |
|--------|-------|------|
| 001 | 해외선물 주문 | CME, EUREX 등 해외 선물 |
| 002 | 해외선물 정정취소 | 주문 정정/취소 |
| 004 | 해외선물 잔고 | 미결제 내역 조회 |
| 007 | 해외선물 현재가 | 실시간 시세 |

---

## 기타 API

### 장내채권

| API ID | API명 | 설명 |
|--------|-------|------|
| 001 | 장내채권 현재가 | 채권 시세 조회 |
| 002 | 장내채권 호가 | 호가 정보 |
| 003 | 장내채권 주문 | 채권 매매 |

### ELW (주식워런트증권)

| API ID | API명 | 설명 |
|--------|-------|------|
| 001 | ELW 현재가 | ELW 시세 |
| 002 | ELW 민감도지표 | 델타, 감마, 세타 등 |
| 003 | ELW 종목비교 | 종목간 비교 분석 |

### ETF/ETN

| API ID | API명 | 설명 |
|--------|-------|------|
| 001 | ETF 현재가 | ETF 시세 |
| 002 | ETF NAV/괴리율 | 순자산가치 및 괴리율 |
| 003 | ETN 현재가 | ETN 시세 |

---

## 실시간 데이터 (WebSocket)

### WebSocket 접속 정보

| 환경 | URL |
|------|-----|
| **실전투자** | `ws://ops.koreainvestment.com:21000` |
| **모의투자** | `ws://ops.koreainvestment.com:31000` |

### 실시간 데이터 종류

| TR ID | 데이터명 | 설명 |
|-------|----------|------|
| H0STCNT0 | 실시간 체결가 | 주식 체결 정보 |
| H0STASP0 | 실시간 호가 | 매수/매도 호가 |
| H0STCNI0 | 실시간 체결통보 | 주문 체결 알림 (계좌별) |
| H0STCNI9 | 실시간 체결통보 | 주문 체결 알림 (전체) |
| H0IFCNT0 | 업종 실시간 체결 | 업종지수 체결 |

### WebSocket 메시지 형식

**구독 요청:**

```json
{
  "header": {
    "approval_key": "접속키",
    "custtype": "P",
    "tr_type": "1",
    "content-type": "utf-8"
  },
  "body": {
    "input": {
      "tr_id": "H0STCNT0",
      "tr_key": "005930"
    }
  }
}
```

**수신 데이터 예시:**

```
H0STCNT0|005930|092500|55000|100|...
```

---

## API 호출 제한

### REST API 제한

| 항목 | 제한 |
|------|------|
| **초당 호출** | 20회 |
| **일일 호출** | 제한 없음 (단, 과도한 호출 시 제재) |
| **토큰 유효기간** | 24시간 |

### WebSocket 제한

| 항목 | 제한 |
|------|------|
| **동시 구독** | 40건 |
| **연결 유지** | 자동 ping/pong |

### 주의사항

- 토큰 재발급은 1분에 1회로 제한
- 동일 API 반복 호출 시 캐싱 권장
- 시세 조회 API는 캐싱 TTL 최소 1초 권장

---

## 에러 코드

### 공통 에러 코드

| 코드 | 메시지 | 설명 |
|------|--------|------|
| 0 | 정상 | 성공 |
| EGW00001 | 시스템 에러 | 서버 내부 오류 |
| EGW00002 | 잘못된 요청 | 파라미터 오류 |
| EGW00003 | 인증 실패 | 토큰 만료/오류 |
| EGW00121 | 유효하지 않은 토큰 | 토큰 재발급 필요 |
| EGW00123 | 접근 권한 없음 | API 권한 미신청 |

### 주문 관련 에러 코드

| 코드 | 메시지 | 설명 |
|------|--------|------|
| OPSQ0001 | 주문수량 오류 | 주문 수량 초과 |
| OPSQ0002 | 주문가격 오류 | 호가 단위 오류 |
| OPSQ0013 | 잔고부족 | 예수금/잔고 부족 |
| OPSQ0019 | 거래시간 외 | 장 마감 |

---

## 프로젝트 구현 현황

### 구현 완료

| 카테고리 | API | 파일 위치 |
|----------|-----|-----------|
| 인증 | 토큰 발급 | `src/api/kis_auth.py` |
| 시세 | 현재가 조회 | `src/api/kis_client.py` |
| 시세 | 일봉 데이터 | `src/api/kis_client.py` |
| 주문 | 매수/매도 | `src/api/kis_client.py` |
| 계좌 | 잔고 조회 | `src/api/kis_client.py` |
| 계좌 | 주문내역 조회 | `src/api/kis_client.py` |

### 구현 예정

| 우선순위 | 카테고리 | API | 용도 |
|----------|----------|-----|------|
| 높음 | 시세 | 분봉 조회 | 단기 매매 전략 |
| 높음 | 실시간 | WebSocket 체결가 | 실시간 모니터링 |
| 중간 | 재무 | 재무비율 (PER/PBR) | 가치투자 전략 |
| 중간 | 순위 | 거래량순위 | 모멘텀 전략 |
| 낮음 | 해외 | 미국주식 주문 | 해외투자 확장 |

---

## 참고 자료

### 공식 문서

- [KIS Developers 포털](https://apiportal.koreainvestment.com)
- [GitHub 공식 저장소](https://github.com/koreainvestment/open-trading-api)
- [API 가이드 (Excel 다운로드)](https://apiportal.koreainvestment.com/apiservice)

### 커뮤니티 라이브러리

- [python-kis (PyPI)](https://github.com/Soju06/python-kis) - Python 래퍼 라이브러리
- [kt_kisopenapi](https://github.com/devngho/kt_kisopenapi) - Kotlin/Java 라이브러리

### 학습 자료

- [파이썬으로 배우는 오픈API 트레이딩](https://wikidocs.net/159296)
- [파이썬을 이용한 한국/미국 주식 자동매매 시스템](https://wikidocs.net/165185)
